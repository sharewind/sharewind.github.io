<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="keywords" content=" 耐克赤足系列 耐克赤足2.0 3.0 4.0 5.0 7.0 耐克赤足跑鞋 耐克赤足二代 耐克编织跑鞋 耐克飞线系列 耐克飞线彩虹 耐克飞线气垫      耐克飞线价格 耐克飞线2014 耐克飞线鞋 耐克飞线登月 耐克飞线科技 耐克飞线2015 耐克登月系列 耐克登月3 4 5 6耐克登月系列跑步鞋 耐克阿甘鞋 耐克2013气垫鞋        耐克2014全掌气垫鞋 耐克2015气垫鞋 耐克max90高板反毛皮跑鞋" />
  <meta name="description" content="莆田批发高仿真标耐克系列跑鞋 耐克赤足滴塑新科技超轻NIKE FREE 5.0 耐克Nike Roshe Flyknit新款跑鞋 耐克2013磨砂皮            耐克赤足Nike Free 4.0 Flyknit赤足跑鞋 耐克登月6跑鞋 耐克2013男鞋 Nike Solarsoft Moccasin Woven 编织纹 超轻跑步鞋太阳神反毛皮 耐克2014飞线 耐克2015飞线      耐克登月NIKE FLYKNIT LUNAR2+编织版  耐克2013 耐克20K6代 7代 耐克87代系列轻量跑鞋" />
  
  <title>Java NIO Buffer | sharewind coder blog</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="《Java NIO》学习笔记 —— Buffer篇 Java Buffer 类图 缓存区的基本概念容量(Capacity)缓冲区能够容纳的数据元素的最大数量。这一容量在缓冲区创建时被设定，并且永远不能被改变。 上界(Limit)缓冲区的第一个不能被读或写的元素。或者说，缓冲区现存元素的计数。 位置（Position）下">
<meta property="og:type" content="article">
<meta property="og:title" content="Java NIO Buffer">
<meta property="og:url" content="http://yoursite.com/2012/12/12/2012-12-12-java-nio-buffer/index.html">
<meta property="og:site_name" content="sharewind coder blog">
<meta property="og:description" content="《Java NIO》学习笔记 —— Buffer篇 Java Buffer 类图 缓存区的基本概念容量(Capacity)缓冲区能够容纳的数据元素的最大数量。这一容量在缓冲区创建时被设定，并且永远不能被改变。 上界(Limit)缓冲区的第一个不能被读或写的元素。或者说，缓冲区现存元素的计数。 位置（Position）下一个要被读或写的元素的索引。位置会自动由相应的get()和put() 方法更新。">
<meta property="og:image" content="http://yoursite.com/pics/java-buffer-class.jpg">
<meta property="og:updated_time" content="2014-03-20T03:06:15.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Java NIO Buffer">
<meta name="twitter:description" content="《Java NIO》学习笔记 —— Buffer篇 Java Buffer 类图 缓存区的基本概念容量(Capacity)缓冲区能够容纳的数据元素的最大数量。这一容量在缓冲区创建时被设定，并且永远不能被改变。 上界(Limit)缓冲区的第一个不能被读或写的元素。或者说，缓冲区现存元素的计数。 位置（Position）下一个要被读或写的元素的索引。位置会自动由相应的get()和put() 方法更新。">
<meta name="twitter:image" content="http://yoursite.com/pics/java-buffer-class.jpg">
  
    <link rel="alternate" href="/atom.xml" title="sharewind coder blog" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link rel="stylesheet" href="/css/style.css">
  

</head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">sharewind coder blog</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://yoursite.com"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main"><article id="post-2012-12-12-java-nio-buffer" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2012/12/12/2012-12-12-java-nio-buffer/" class="article-date">
  <time datetime="2012-12-12T02:38:00.000Z" itemprop="datePublished">2012-12-12</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Java-NIO/">Java NIO</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      Java NIO Buffer
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>《Java NIO》学习笔记 —— Buffer篇</p>
<h4 id="Java-Buffer-类图"><a href="#Java-Buffer-类图" class="headerlink" title="Java Buffer 类图"></a>Java Buffer 类图</h4><p><img src="/pics/java-buffer-class.jpg" alt="java buffer class"></p>
<h4 id="缓存区的基本概念"><a href="#缓存区的基本概念" class="headerlink" title="缓存区的基本概念"></a>缓存区的基本概念</h4><p><strong>容量(Capacity)</strong><br>缓冲区能够容纳的数据元素的最大数量。这一容量在缓冲区创建时被设定，并且永远不能被改变。</p>
<p><strong>上界(Limit)</strong><br>缓冲区的第一个不能被读或写的元素。或者说，缓冲区现存元素的计数。</p>
<p><strong>位置（Position）</strong><br>下一个要被读或写的元素的索引。位置会自动由相应的get()和put() 方法更新。</p>
<p><strong>标志（Mark）</strong><br>一个标志位置。调用mark()来设定mark = position。调用reset() 设定position = mark。标记在设定之前是未定义的(undefined)。</p>
<p>####Buffer 的主要方法</p>
<pre><code>public abstract class Buffer {

    Buffer(int mark, int pos, int lim, int cap)

    public final int capacity() 

    public final int position()     
    public final Buffer position(int newPosition) 

    public final int limit()      
    public final Buffer limit(int newLimit)       

    public final Buffer mark()     
    public final Buffer reset() 

    public final Buffer clear()

    public final Buffer flip()
    public final Buffer rewind() 

    public final int remaining()
    public final boolean hasRemaining() 

    public abstract boolean isReadOnly();
    public abstract boolean isDirect();
}
</code></pre><p>ByteBuffer 的主要方法</p>
<pre><code>public abstract class ByteBuffer
    extends Buffer
    implements Comparable&lt;ByteBuffer&gt;{
    public abstract byte get();
    public abstract byte get(int index);
    public abstract ByteBuffer put(byte b);
    public abstract ByteBuffer put(int index, byte b);
}
</code></pre><p><strong>1. 填充</strong><br>调用put方法把byte 放入Buffer，初始状态position=0,limit = capacity;<br>buffer.put((byte)’H’).put((byte)’e’).put((byte)’l’).put((byte)’l’).put((byte)’o’);</p>
<p><strong>2. 翻转</strong><br>当写入完成后，我们需要设定上限来指定写入的有效内容的末端，然后将位置重置为0.<br>buffer.limit(buffer.position()).position(0)</p>
<p>可以用buffer.flip(); 方法将缓存区从可以继续写入的状态 翻转成一个准备读出的状态。  </p>
<p><strong>rewind()</strong> 方法与flip()类似，但不影响上界属性，它只是将位置值设回0，可以重新读取已被翻转的缓冲区的数据。<br>如果将缓冲区翻转两次，会将实际大小变为0，position和limit 都为0。</p>
<p><strong>3. 释放</strong>(即读取数据)</p>
<pre><code>int count = buffer.remaining();
byte[] bytes = new byte[cout]; 
int i = 0;
while(buffer.hasRemaining()){
    bytes[i++] = buffer.get();
}
</code></pre><p><strong>4. 压缩</strong><br>有时候只想从缓冲区释放一部分数据，而不是全部，然后重新填充。API为我们提供了compact 方法，compact 方法将会复制当前position未读取的数据到缓存区开头，然后重新设置 position = limit - position, 并将limit 恢复到capacity, limit = capacity。<br>应用场景：  </p>
<pre><code>public class ChannelCopy {

    public static void main(String[] args) throws IOException {
        ReadableByteChannel in = Channels.newChannel(System.in);
        WritableByteChannel out = Channels.newChannel(System.out);
        copyChannel(in,out);
        System.out.println(&quot;copy1&quot;);
//        copyChannel2(in,out);
//        System.out.println(&quot;copy2&quot;);
        in.close();
        out.close();
    }

    private static void copyChannel2(ReadableByteChannel src, WritableByteChannel dest) throws IOException {

        ByteBuffer buffer = ByteBuffer.allocate(1024);
        while(src.read(buffer) &gt; 0 ){
            buffer.flip();
            dest.write(buffer);
            buffer.compact();
        }

        buffer.flip();
        while(buffer.hasRemaining()){
            dest.write(buffer);
        }

    }

    private static void copyChannel(ReadableByteChannel src, WritableByteChannel dest) throws IOException {

        ByteBuffer buffer = ByteBuffer.allocate(1024);
        while(src.read(buffer) &gt; 0 ){
            buffer.flip();
            while(buffer.hasRemaining()){
                dest.write(buffer);
            }
            buffer.clear();
        }

    }

}
</code></pre><p><strong>5. 比较</strong></p>
<pre><code>public abstract class ByteBuffer implements Comparable&lt;ByteBuffer&gt;{
    public boolean equals(Object obj)
    public int compareTo(Object obj)
}
</code></pre><p>两个缓冲区被认为相等的充要条件：  </p>
<ul>
<li>两个对象类型相同。</li>
<li>两个对象都剩余同样数量的元素</li>
<li>在每个缓冲区中应被get() 方法返回的剩余数据元素序列必须一致。</li>
</ul>
<p>ByteBuffer.equals 源码</p>
<pre><code>public boolean equals(Object ob) {
    if (this == ob)
        return true;
    if (!(ob instanceof ByteBuffer))
        return false;
    ByteBuffer that = (ByteBuffer)ob;
    if (this.remaining() != that.remaining())
        return false;
    int p = this.position();
    for (int i = this.limit() - 1, j = that.limit() - 1; i &gt;= p; i--, j--)
        if (!equals(this.get(i), that.get(j)))
            return false;
    return true;
}
</code></pre><p><strong>6. 批量移动</strong></p>
<pre><code>public abstract class ByteBuffer extends Buffer implements Comparable&lt;ByteBuffer&gt;{
    public ByteBuffer get(byte[] dst, int offset, int length)  
    public ByteBuffer get(byte[] dst)  
    public ByteBuffer put(ByteBuffer src)  
    public ByteBuffer put(byte[] src, int offset, int length)  
    public final ByteBuffer put(byte[] src)
}
</code></pre><p>● 从buffer中读取数据到数组<br>ByteBuffer源码：    </p>
<pre><code>public ByteBuffer get(byte[] dst, int offset, int length) {
    checkBounds(offset, length, dst.length);
    if (length &gt; remaining())
        throw new BufferUnderflowException();
    int end = offset + length;
    for (int i = offset; i &lt; end; i++)
        dst[i] = get();
    return this;
}


public ByteBuffer get(byte[] dst) {
    return get(dst, 0, dst.length);
}
</code></pre><p> ● 把另外一个buffer剩余的数据放入Buffer中<br>ByteBuffer源码：  </p>
<pre><code>public ByteBuffer put(ByteBuffer src) {
    if (src == this)
        throw new IllegalArgumentException();
    int n = src.remaining();
    if (n &gt; remaining())
        throw new BufferOverflowException();
    for (int i = 0; i &lt; n; i++)
        put(src.get());
    return this;
}
</code></pre><p> ● 把数组元素放入Buffer中<br>ByteBuffer源码：  </p>
<pre><code>public ByteBuffer put(byte[] src, int offset, int length) {
    checkBounds(offset, length, src.length);
    if (length &gt; remaining())
        throw new BufferOverflowException();
    int end = offset + length;
    for (int i = offset; i &lt; end; i++)
        this.put(src[i]);
    return this;
}

public final ByteBuffer put(byte[] src) {
    return put(src, 0, src.length);
}
</code></pre><p><strong>7. 线程安全</strong><br>多个当前线程使用缓冲区是不安全的。如果一个缓冲区由不止一个线程使用，则应该通过适当的同步来控制对该缓冲区的访问。 </p>
<p>####参考资料</p>
<ul>
<li><a href="http://blog.csdn.net/jiang_bing/article/details/7878390" target="_blank" rel="noopener">java nio Buffer 中 compact的作用</a></li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2012/12/12/2012-12-12-java-nio-buffer/" data-id="cja9nu266000ubu5i8myib4xz" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2012/12/18/2012-12-18-java-nio-char-buffer/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Newer</strong>
      <div class="article-nav-title">
        
          Java NIO Char Buffer
        
      </div>
    </a>
  
  
    <a href="/2012/12/08/2012-12-08-java-reflection/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">Java 反射</div>
    </a>
  
</nav>

  
</article>

</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Categories</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Algorithm/">Algorithm</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Architecture/">Architecture</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/DevTools/">DevTools</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/DevTools-Eclipse/">DevTools Eclipse</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Java/">Java</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Java-Btrace/">Java Btrace</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Java-JVM/">Java JVM</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Java-MultiThreading/">Java MultiThreading</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Java-NIO/">Java NIO</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Java-Reflection/">Java Reflection</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Java-Unicode/">Java Unicode</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Linux-Shell/">Linux Shell</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/MongoDB/">MongoDB</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/NSQ-golang/">NSQ golang</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Python/">Python</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Solr/">Solr</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Solr-Lucene/">Solr Lucene</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Unicode-Python/">Unicode Python</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/git-DevTools/">git DevTools</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/jafka-zookeeper/">jafka zookeeper</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/jsonp-security/">jsonp security</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/thrift/">thrift</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/zookeeper/">zookeeper</a></li></ul>
    </div>
  </div>


  
    

  
    
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/11/">November 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/01/">January 2015</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/02/">February 2014</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/08/">August 2013</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/07/">July 2013</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/03/">March 2013</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2012/12/">December 2012</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2017/11/21/hello-world/">Hello World</a>
          </li>
        
          <li>
            <a href="/2015/01/16/2015-01-16-process-task-by-queue/">process task by queue</a>
          </li>
        
          <li>
            <a href="/2015/01/15/2015-01-15-threadpoolexecutor/">ThreadPoolExecutor 学习笔记</a>
          </li>
        
          <li>
            <a href="/2014/02/19/2014-02-19-nsq-internals/">nsq internals</a>
          </li>
        
          <li>
            <a href="/2014/02/18/2014-02-18-nsq-design/">nsq design</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">

 	<div id="footer-info" class="inner">
     咨询QQ：<a title="点击这里给我发消息" href="http://wpa.qq.com/msgrd?v=3&amp;uin=2727291807&amp;site=www.cactussoft.cn&amp;menu=yes" target="_blank"><img src="http://wpa.qq.com/pa?p=2:2727291807:41"></a>
     微信 <img src="/pics/qrcode.jpg" style="width:100px;height:100px;">
 	</div>
   	<div id="footer-info" class="inner">
     	<a href="http://www.618shoe.com/">莆田高仿鞋批发</a>&nbsp;&nbsp;
     	<a href="http://www.618shoe.com/">1：1高仿鞋批发</a>&nbsp;&nbsp;
     	<a href="http://www.618shoe.com/">高仿鞋批发市场</a>&nbsp;&nbsp;
     	<a href="http://www.618shoe.com/">高仿鞋网</a>&nbsp;&nbsp;
     	<a href="http://www.618shoe.com/">广州高仿鞋批发</a>&nbsp;&nbsp;
    	<a href="http://www.618shoe.com/">外贸尾单鞋批发</a>&nbsp;&nbsp;
    	<a href="http://www.618shoe.com/">精仿鞋专线</a>&nbsp;&nbsp;
	</div>
 	<div id="footer-info" class="inner">
         <a href="http://www.618shoe.com/">莆田高仿鞋批发</a>&nbsp;&nbsp;
         公司网站:&nbsp;&nbsp;<a href="http://www.618shoe.com//" target="_blank">http://www.618shoe.com/</a>&nbsp;&nbsp;
         <a href="http://www.618shoe.com/">高仿鞋批发市场</a>
 	</div>
    <div id="footer-info" class="inner">
      &copy; 2017 Sharewind<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>

  </div>
</body>
</html>
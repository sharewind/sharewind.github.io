<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="keywords" content=" 耐克赤足系列 耐克赤足2.0 3.0 4.0 5.0 7.0 耐克赤足跑鞋 耐克赤足二代 耐克编织跑鞋 耐克飞线系列 耐克飞线彩虹 耐克飞线气垫      耐克飞线价格 耐克飞线2014 耐克飞线鞋 耐克飞线登月 耐克飞线科技 耐克飞线2015 耐克登月系列 耐克登月3 4 5 6耐克登月系列跑步鞋 耐克阿甘鞋 耐克2013气垫鞋        耐克2014全掌气垫鞋 耐克2015气垫鞋 耐克max90高板反毛皮跑鞋" />
  <meta name="description" content="莆田批发高仿真标耐克系列跑鞋 耐克赤足滴塑新科技超轻NIKE FREE 5.0 耐克Nike Roshe Flyknit新款跑鞋 耐克2013磨砂皮            耐克赤足Nike Free 4.0 Flyknit赤足跑鞋 耐克登月6跑鞋 耐克2013男鞋 Nike Solarsoft Moccasin Woven 编织纹 超轻跑步鞋太阳神反毛皮 耐克2014飞线 耐克2015飞线      耐克登月NIKE FLYKNIT LUNAR2+编织版  耐克2013 耐克20K6代 7代 耐克87代系列轻量跑鞋" />
  
  <title>sharewind coder blog</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta property="og:type" content="website">
<meta property="og:title" content="sharewind coder blog">
<meta property="og:url" content="http://yoursite.com/page/3/index.html">
<meta property="og:site_name" content="sharewind coder blog">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="sharewind coder blog">
  
    <link rel="alternate" href="/atom.xml" title="sharewind coder blog" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link rel="stylesheet" href="/css/style.css">
  

</head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">sharewind coder blog</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="Flux RSS"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Rechercher"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://yoursite.com"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main">
  
    <article id="post-javap" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/blog/2013/03/14/javap/" class="article-date">
  <time datetime="2013-03-14T10:42:00.000Z" itemprop="datePublished">2013-03-14</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Java/">Java</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/blog/2013/03/14/javap/">javap</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>javap - The Java Class File Disassembler</p>
<p>Java Class文件反编译工具 </p>
<pre><code>C:\Users\Administrator&gt;javap -help
Usage: javap &lt;options&gt; &lt;classes&gt;
where possible options include:
  -help  --help  -?        Print this usage message
  -version                 Version information 
  -v  -verbose             Print additional information #打印详细的信息
  -l                       Print line number and local variable tables
  -public                  Show only public classes and members
  -protected               Show protected/public classes and members
  -package                 Show package/protected/public classes
                           and members (default)
  -p  -private             Show all classes and members
  -c                       Disassemble the code
  -s                       Print internal type signatures
  -sysinfo                 Show system info (path, size, date, MD5 hash)
                           of class being processed
  -constants               Show static final constants
  -classpath &lt;path&gt;        Specify where to find user class files
  -bootclasspath &lt;path&gt;    Override location of bootstrap class files
</code></pre><h4 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h4><ul>
<li><a href="http://docs.oracle.com/javase/1.5.0/docs/tooldocs/windows/javap.html" target="_blank" rel="noopener">javap - The Java Class File Disassembler</a></li>
</ul>

      
    </div>
    <footer class="article-footer2">
      <div id="footer-info" class="inner">
        <a href="http://www.618shoe.com/">莆田1:1精仿鞋微信号</a>
        <a href="http://www.618shoe.com/">莆田高仿鞋子的价格表</a>
        <a href="http://www.618shoe.com/">关于莆田仿鞋</a>
        <a href="http://www.618shoe.com/">莆田高仿鞋淘宝店店名</a>
        <a href="http://www.618shoe.com/">莆田精仿鞋官网</a>
         咨询QQ：<a title="点击这里给我发消息" href="http://wpa.qq.com/msgrd?v=3&amp;uin=2727291807&amp;site=www.cactussoft.cn&amp;menu=yes" target="_blank"><img src="http://wpa.qq.com/pa?p=2:2727291807:41"></a>
      </div>
        <div id="footer-info" class="inner">
          <a href="http://www.618shoe.com/">莆田高仿鞋批发</a>&nbsp;&nbsp;
          <a href="http://www.618shoe.com/">1：1高仿鞋批发</a>&nbsp;&nbsp;
          <a href="http://www.618shoe.com/">高仿鞋批发市场</a>&nbsp;&nbsp;
          <a href="http://www.618shoe.com/">高仿鞋网</a>&nbsp;&nbsp;
          <a href="http://www.618shoe.com/">广州高仿鞋批发</a>&nbsp;&nbsp;
          <a href="http://www.618shoe.com/">外贸尾单鞋批发</a>&nbsp;&nbsp;
          <a href="http://www.618shoe.com/">精仿鞋专线</a>&nbsp;&nbsp;
      </div>
      <div id="footer-info" class="inner">
             <a href="http://www.618shoe.com/">莆田高仿鞋批发</a>&nbsp;&nbsp;
             公司网站:&nbsp;&nbsp;<a href="http://www.618shoe.com//" target="_blank">http://www.618shoe.com/</a>&nbsp;&nbsp;
             <a href="http://www.618shoe.com/">高仿鞋批发市场</a>
             微信 <img src="/pics/qrcode.jpg" style="width:100px;height:100px;">
      </div>
    </footer>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/blog/2013/03/14/javap/" data-id="cja9requ1001vif5it8fks9x3" class="article-share-link">Partager</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-solr-4-dot-1-install-guide" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/blog/2013/03/08/solr-4-dot-1-install-guide/" class="article-date">
  <time datetime="2013-03-08T01:29:00.000Z" itemprop="datePublished">2013-03-08</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Solr-Lucene/">Solr Lucene</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/blog/2013/03/08/solr-4-dot-1-install-guide/">solr 4.1 install guide</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>1.从<a href="http://lucene.apache.org/solr/" target="_blank" rel="noopener">Solr的官方网站</a>下载Solr 4.1的安装包.</p>
<p>2.解压solr-4.1.0.zip 到安装目录。</p>
<p>3.将 solr-4.1.0目录下的example复制成目标索引项目的名称 cloudatlas.</p>
<p>4.进行 solr-4.1.0\cloudatlas\solr目录，复制 collection1 为索引文档的名称。<br>   collection1 –&gt; photos, users.</p>
<p>5.在 solr-4.1.0\cloudatlas\solr\solr.xml文件中，配置两个core 实例。</p>
<pre><code>&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;
&lt;solr persistent=&quot;true&quot;&gt;
  &lt;cores defaultCoreName=&quot;photos&quot; adminPath=&quot;/admin/cores&quot; zkClientTimeout=&quot;${zkClientTimeout:15000}&quot; hostPort=&quot;8983&quot; hostContext=&quot;solr&quot;&gt;
    &lt;core name=&quot;photos&quot; loadOnStartup=&quot;true&quot; instanceDir=&quot;photos\&quot; transient=&quot;false&quot; /&gt;
    &lt;core name=&quot;users&quot;  loadOnStartup=&quot;true&quot; instanceDir=&quot;users\&quot; transient=&quot;false&quot; /&gt;
  &lt;/cores&gt;
&lt;/solr&gt;
</code></pre><p>6.配置IK中文分词。</p>
<pre><code>在 [googlecode](https://code.google.com/p/ik-analyzer/) 下载IK分词器的 jar 包。    在 solr-4.1.0\cloudatlas\solr 下创建 lib 目录，并将下载的IK分词器jar放到该目录中。

在 solr-4.1.0\cloudatlas\solr\photos\conf\solrconfig.xml 配置lib 目录  

&lt;lib dir=&quot;../lib&quot; /&gt;

在 solr-4.1.0\cloudatlas\solr\photos\conf\schema.xml 配置中文分词的field_type.

 &lt;fieldType name=&quot;text_cn&quot; class=&quot;solr.TextField&quot; positionIncrementGap=&quot;100&quot;&gt;
  &lt;analyzer type=&quot;index&quot;&gt;
    &lt;tokenizer class=&quot;org.wltea.analyzer.solr.IKTokenizerFactory&quot; useSmart =&quot;false&quot;/&gt;
  &lt;/analyzer&gt;
  &lt;analyzer type=&quot;query&quot;&gt;
    &lt;tokenizer class=&quot;org.wltea.analyzer.solr.IKTokenizerFactory&quot; useSmart =&quot;false&quot;/&gt;
  &lt;/analyzer&gt;
&lt;/fieldType&gt;


采用中文分词的field配置：

    &lt;field name=&quot;photo_desc&quot; type=&quot;text_cn&quot; indexed=&quot;true&quot; stored=&quot;true&quot;/&gt;
</code></pre><p>7.在solr.xml 中注释 elevator 的配置（因为我们的schema 字段配置与 elevate中的字段配置有冲突）</p>
<pre><code>&lt;!-- Query Elevation Component

     http://wiki.apache.org/solr/QueryElevationComponent

     a search component that enables you to configure the top
     results for a given query regardless of the normal lucene
     scoring.
  --&gt;
&lt;searchComponent name=&quot;elevator&quot; class=&quot;solr.QueryElevationComponent&quot; &gt;
  &lt;!-- pick a fieldType to analyze queries --&gt;
  &lt;str name=&quot;queryFieldType&quot;&gt;string&lt;/str&gt;
  &lt;str name=&quot;config-file&quot;&gt;elevate.xml&lt;/str&gt;
&lt;/searchComponent&gt;

&lt;!-- A request handler for demonstrating the elevator component --&gt;
&lt;requestHandler name=&quot;/elevate&quot; class=&quot;solr.SearchHandler&quot; startup=&quot;lazy&quot;&gt;
  &lt;lst name=&quot;defaults&quot;&gt;
    &lt;str name=&quot;echoParams&quot;&gt;explicit&lt;/str&gt;
    &lt;str name=&quot;df&quot;&gt;text&lt;/str&gt;
  &lt;/lst&gt;
  &lt;arr name=&quot;last-components&quot;&gt;
    &lt;str&gt;elevator&lt;/str&gt;
  &lt;/arr&gt;
&lt;/requestHandler&gt;
</code></pre><p>8.配置索引的文档schema.</p>
<p>photos的schema.xml 配置</p>
<pre><code>&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;    
&lt;schema name=&quot;photos&quot; version=&quot;1.5&quot;&gt;

 &lt;fields&gt;        
   &lt;field name=&quot;id&quot; type=&quot;long&quot; indexed=&quot;true&quot; stored=&quot;true&quot; required=&quot;true&quot; multiValued=&quot;false&quot; /&gt; 
   &lt;field name=&quot;user_id&quot; type=&quot;long&quot; indexed=&quot;true&quot; stored=&quot;true&quot; omitNorms=&quot;true&quot; /&gt;   
   &lt;field name=&quot;folder_id&quot; type=&quot;long&quot; indexed=&quot;true&quot; stored=&quot;true&quot; omitNorms=&quot;true&quot; /&gt;   
   &lt;field name=&quot;folder_name&quot; type=&quot;text_cn&quot; indexed=&quot;true&quot; stored=&quot;true&quot;/&gt;
   &lt;field name=&quot;folder_desc&quot; type=&quot;text_cn&quot; indexed=&quot;true&quot; stored=&quot;true&quot;/&gt;
   &lt;field name=&quot;photo_desc&quot; type=&quot;text_cn&quot; indexed=&quot;true&quot; stored=&quot;true&quot;/&gt;
   &lt;field name=&quot;farm&quot; type=&quot;string&quot; indexed=&quot;false&quot; stored=&quot;true&quot; omitNorms=&quot;true&quot;/&gt;
   &lt;field name=&quot;bucket&quot; type=&quot;string&quot; indexed=&quot;false&quot; stored=&quot;true&quot; omitNorms=&quot;true&quot;/&gt;
   &lt;field name=&quot;storage_keys&quot; type=&quot;string&quot; indexed=&quot;false&quot; stored=&quot;true&quot; omitNorms=&quot;true&quot;/&gt;
   &lt;!-- catchall field, containing all other searchable text fields (implemented
        via copyField further on in this schema  --&gt;
   &lt;field name=&quot;text&quot; type=&quot;text_cn&quot; indexed=&quot;true&quot; stored=&quot;false&quot; multiValued=&quot;true&quot;/&gt;
   &lt;field name=&quot;_version_&quot; type=&quot;long&quot; indexed=&quot;true&quot; stored=&quot;true&quot; multiValued=&quot;false&quot; /&gt;   
 &lt;/fields&gt;


 &lt;!-- Field to use to determine and enforce document uniqueness. 
      Unless this field is marked with required=&quot;false&quot;, it will be a required field
   --&gt;
 &lt;uniqueKey&gt;id&lt;/uniqueKey&gt;

   &lt;copyField source=&quot;folder_name&quot; dest=&quot;text&quot;/&gt;
   &lt;copyField source=&quot;folder_desc&quot; dest=&quot;text&quot;/&gt;
   &lt;copyField source=&quot;photo_desc&quot; dest=&quot;text&quot;/&gt;  

  &lt;types&gt;

    &lt;!-- The StrField type is not analyzed, but indexed/stored verbatim. --&gt;
    &lt;fieldType name=&quot;string&quot; class=&quot;solr.StrField&quot; sortMissingLast=&quot;true&quot; /&gt;

    &lt;!-- boolean type: &quot;true&quot; or &quot;false&quot; --&gt;
    &lt;fieldType name=&quot;boolean&quot; class=&quot;solr.BoolField&quot; sortMissingLast=&quot;true&quot;/&gt;

    &lt;fieldType name=&quot;int&quot; class=&quot;solr.TrieIntField&quot; precisionStep=&quot;0&quot; positionIncrementGap=&quot;0&quot;/&gt;
    &lt;fieldType name=&quot;float&quot; class=&quot;solr.TrieFloatField&quot; precisionStep=&quot;0&quot; positionIncrementGap=&quot;0&quot;/&gt;
    &lt;fieldType name=&quot;long&quot; class=&quot;solr.TrieLongField&quot; precisionStep=&quot;0&quot; positionIncrementGap=&quot;0&quot;/&gt;
    &lt;fieldType name=&quot;double&quot; class=&quot;solr.TrieDoubleField&quot; precisionStep=&quot;0&quot; positionIncrementGap=&quot;0&quot;/&gt;

    &lt;fieldType name=&quot;text_cn&quot; class=&quot;solr.TextField&quot; positionIncrementGap=&quot;100&quot;&gt;
      &lt;analyzer type=&quot;index&quot;&gt;
        &lt;tokenizer class=&quot;org.wltea.analyzer.solr.IKTokenizerFactory&quot; useSmart =&quot;false&quot;/&gt;
      &lt;/analyzer&gt;
      &lt;analyzer type=&quot;query&quot;&gt;
        &lt;tokenizer class=&quot;org.wltea.analyzer.solr.IKTokenizerFactory&quot; useSmart =&quot;false&quot;/&gt;
      &lt;/analyzer&gt;
    &lt;/fieldType&gt;
 &lt;/types&gt;

    &lt;!-- field for the QueryParser to use when an explicit fieldname is absent --&gt;
    &lt;defaultSearchField&gt;text&lt;/defaultSearchField&gt;

    &lt;!-- SolrQueryParser configuration: defaultOperator=&quot;AND|OR&quot; --&gt;
    &lt;solrQueryParser defaultOperator=&quot;OR&quot;/&gt;

&lt;/schema&gt;
</code></pre><p>users的schema 配置</p>
<pre><code>&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;

&lt;schema name=&quot;users&quot; version=&quot;1.5&quot;&gt;

 &lt;fields&gt;        
   &lt;field name=&quot;id&quot; type=&quot;long&quot; indexed=&quot;true&quot; stored=&quot;true&quot; required=&quot;true&quot; multiValued=&quot;false&quot; /&gt; 
   &lt;field name=&quot;nickname&quot; type=&quot;text_cn&quot; indexed=&quot;true&quot; stored=&quot;true&quot;/&gt;
   &lt;field name=&quot;text&quot; type=&quot;string&quot; indexed=&quot;true&quot; stored=&quot;false&quot; multiValued=&quot;true&quot;/&gt;
   &lt;field name=&quot;_version_&quot; type=&quot;long&quot; indexed=&quot;true&quot; stored=&quot;true&quot; multiValued=&quot;false&quot; /&gt;
 &lt;/fields&gt;


 &lt;!-- Field to use to determine and enforce document uniqueness. 
      Unless this field is marked with required=&quot;false&quot;, it will be a required field
   --&gt;
 &lt;uniqueKey&gt;id&lt;/uniqueKey&gt;

&lt;!--
   &lt;copyField source=&quot;folder_name&quot; dest=&quot;text&quot;/&gt;
   &lt;copyField source=&quot;folder_desc&quot; dest=&quot;text&quot;/&gt;
   &lt;copyField source=&quot;photo_desc&quot; dest=&quot;text&quot;/&gt;  
 --&gt;

  &lt;types&gt;
    &lt;!-- The StrField type is not analyzed, but indexed/stored verbatim. --&gt;
    &lt;fieldType name=&quot;string&quot; class=&quot;solr.StrField&quot; sortMissingLast=&quot;true&quot; /&gt;

    &lt;!-- boolean type: &quot;true&quot; or &quot;false&quot; --&gt;
    &lt;fieldType name=&quot;boolean&quot; class=&quot;solr.BoolField&quot; sortMissingLast=&quot;true&quot;/&gt;

    &lt;fieldType name=&quot;int&quot; class=&quot;solr.TrieIntField&quot; precisionStep=&quot;0&quot; positionIncrementGap=&quot;0&quot;/&gt;
    &lt;fieldType name=&quot;float&quot; class=&quot;solr.TrieFloatField&quot; precisionStep=&quot;0&quot; positionIncrementGap=&quot;0&quot;/&gt;
    &lt;fieldType name=&quot;long&quot; class=&quot;solr.TrieLongField&quot; precisionStep=&quot;0&quot; positionIncrementGap=&quot;0&quot;/&gt;
    &lt;fieldType name=&quot;double&quot; class=&quot;solr.TrieDoubleField&quot; precisionStep=&quot;0&quot; positionIncrementGap=&quot;0&quot;/&gt;

    &lt;fieldType name=&quot;text_cn&quot; class=&quot;solr.TextField&quot; positionIncrementGap=&quot;100&quot;&gt;
      &lt;analyzer type=&quot;index&quot;&gt;
        &lt;tokenizer class=&quot;org.wltea.analyzer.solr.IKTokenizerFactory&quot; useSmart =&quot;false&quot;/&gt;
      &lt;/analyzer&gt;
      &lt;analyzer type=&quot;query&quot;&gt;
        &lt;tokenizer class=&quot;org.wltea.analyzer.solr.IKTokenizerFactory&quot; useSmart =&quot;false&quot;/&gt;
      &lt;/analyzer&gt;
    &lt;/fieldType&gt;
 &lt;/types&gt;

     &lt;!-- field for the QueryParser to use when an explicit fieldname is absent --&gt;
    &lt;defaultSearchField&gt;nickname&lt;/defaultSearchField&gt;

    &lt;!-- SolrQueryParser configuration: defaultOperator=&quot;AND|OR&quot; --&gt;
    &lt;solrQueryParser defaultOperator=&quot;OR&quot;/&gt;

&lt;/schema&gt;
</code></pre><p>10.启动solr 服务 </p>
<pre><code>java -jar start.jar 
</code></pre><h4 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h4><ul>
<li><a href="http://lucene.apache.org/solr/4_2_0/tutorial.html" target="_blank" rel="noopener">Solr Tutorial</a></li>
</ul>

      
    </div>
    <footer class="article-footer2">
      <div id="footer-info" class="inner">
        <a href="http://www.618shoe.com/">莆田1:1精仿鞋微信号</a>
        <a href="http://www.618shoe.com/">莆田高仿鞋子的价格表</a>
        <a href="http://www.618shoe.com/">关于莆田仿鞋</a>
        <a href="http://www.618shoe.com/">莆田高仿鞋淘宝店店名</a>
        <a href="http://www.618shoe.com/">莆田精仿鞋官网</a>
         咨询QQ：<a title="点击这里给我发消息" href="http://wpa.qq.com/msgrd?v=3&amp;uin=2727291807&amp;site=www.cactussoft.cn&amp;menu=yes" target="_blank"><img src="http://wpa.qq.com/pa?p=2:2727291807:41"></a>
      </div>
        <div id="footer-info" class="inner">
          <a href="http://www.618shoe.com/">莆田高仿鞋批发</a>&nbsp;&nbsp;
          <a href="http://www.618shoe.com/">1：1高仿鞋批发</a>&nbsp;&nbsp;
          <a href="http://www.618shoe.com/">高仿鞋批发市场</a>&nbsp;&nbsp;
          <a href="http://www.618shoe.com/">高仿鞋网</a>&nbsp;&nbsp;
          <a href="http://www.618shoe.com/">广州高仿鞋批发</a>&nbsp;&nbsp;
          <a href="http://www.618shoe.com/">外贸尾单鞋批发</a>&nbsp;&nbsp;
          <a href="http://www.618shoe.com/">精仿鞋专线</a>&nbsp;&nbsp;
      </div>
      <div id="footer-info" class="inner">
             <a href="http://www.618shoe.com/">莆田高仿鞋批发</a>&nbsp;&nbsp;
             公司网站:&nbsp;&nbsp;<a href="http://www.618shoe.com//" target="_blank">http://www.618shoe.com/</a>&nbsp;&nbsp;
             <a href="http://www.618shoe.com/">高仿鞋批发市场</a>
             微信 <img src="/pics/qrcode.jpg" style="width:100px;height:100px;">
      </div>
    </footer>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/blog/2013/03/08/solr-4-dot-1-install-guide/" data-id="cja9reqty001sif5iqeixxty1" class="article-share-link">Partager</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-java-performance-diagnosis" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/blog/2013/03/05/java-performance-diagnosis/" class="article-date">
  <time datetime="2013-03-05T07:55:00.000Z" itemprop="datePublished">2013-03-05</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Java-JVM/">Java JVM</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/blog/2013/03/05/java-performance-diagnosis/">java performance diagnosis</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <ol>
<li><p>top 命令  </p>
<p> top -H -p pid 列出指定线程中的所有线程，可以查看占用cpu最多的线程。</p>
<p> jstack pid &gt; thread.dump 从thread dump 中找到占用cpu最高的线程，线程id要转化成16进制。</p>
</li>
<li></li>
</ol>

      
    </div>
    <footer class="article-footer2">
      <div id="footer-info" class="inner">
        <a href="http://www.618shoe.com/">莆田1:1精仿鞋微信号</a>
        <a href="http://www.618shoe.com/">莆田高仿鞋子的价格表</a>
        <a href="http://www.618shoe.com/">关于莆田仿鞋</a>
        <a href="http://www.618shoe.com/">莆田高仿鞋淘宝店店名</a>
        <a href="http://www.618shoe.com/">莆田精仿鞋官网</a>
         咨询QQ：<a title="点击这里给我发消息" href="http://wpa.qq.com/msgrd?v=3&amp;uin=2727291807&amp;site=www.cactussoft.cn&amp;menu=yes" target="_blank"><img src="http://wpa.qq.com/pa?p=2:2727291807:41"></a>
      </div>
        <div id="footer-info" class="inner">
          <a href="http://www.618shoe.com/">莆田高仿鞋批发</a>&nbsp;&nbsp;
          <a href="http://www.618shoe.com/">1：1高仿鞋批发</a>&nbsp;&nbsp;
          <a href="http://www.618shoe.com/">高仿鞋批发市场</a>&nbsp;&nbsp;
          <a href="http://www.618shoe.com/">高仿鞋网</a>&nbsp;&nbsp;
          <a href="http://www.618shoe.com/">广州高仿鞋批发</a>&nbsp;&nbsp;
          <a href="http://www.618shoe.com/">外贸尾单鞋批发</a>&nbsp;&nbsp;
          <a href="http://www.618shoe.com/">精仿鞋专线</a>&nbsp;&nbsp;
      </div>
      <div id="footer-info" class="inner">
             <a href="http://www.618shoe.com/">莆田高仿鞋批发</a>&nbsp;&nbsp;
             公司网站:&nbsp;&nbsp;<a href="http://www.618shoe.com//" target="_blank">http://www.618shoe.com/</a>&nbsp;&nbsp;
             <a href="http://www.618shoe.com/">高仿鞋批发市场</a>
             微信 <img src="/pics/qrcode.jpg" style="width:100px;height:100px;">
      </div>
    </footer>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/blog/2013/03/05/java-performance-diagnosis/" data-id="cja9reqtw001oif5iyrv98rmq" class="article-share-link">Partager</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-hashmap-in-java" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/blog/2013/03/05/hashmap-in-java/" class="article-date">
  <time datetime="2013-03-05T02:04:00.000Z" itemprop="datePublished">2013-03-05</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Java/">Java</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/blog/2013/03/05/hashmap-in-java/">Java基础：HashMap</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <!-- HashMap/ConcurrentHashMap/TreeMap/ConcurrentSkipListMap -->
<p>基于哈希表的 Map 接口的实现。此实现提供所有可选的映射操作，并允许使用 null 值和 null 键。（除了非同步和允许使用 null 之外，HashMap 类与 Hashtable 大致相同。）</p>
<p><strong>HashMap的数据成员</strong></p>
<pre><code>/**
 * The default initial capacity - MUST be a power of two.
 */
//  默认的初始容量大小，必须为2的整数倍
static final int DEFAULT_INITIAL_CAPACITY = 16;

/**
 * The maximum capacity, used if a higher value is implicitly specified
 * by either of the constructors with arguments.
 * MUST be a power of two &lt;= 1&lt;&lt;30.
 */
// 最大容量大小
static final int MAXIMUM_CAPACITY = 1 &lt;&lt; 30;

/**
 * The load factor used when none specified in constructor.
 */
// 默认的加载因子
static final float DEFAULT_LOAD_FACTOR = 0.75f;

/**
 * The table, resized as necessary. Length MUST Always be a power of two.
 */
// 用来存储entry项的数组（即哈希桶）
transient Entry[] table;

/**
 * The number of key-value mappings contained in this map.
 */
// 存放的entry个数
transient int size;

/**
 * The next size value at which to resize (capacity * load factor).
 * @serial
 */
// 阈值 = 容器 * 加载因子，达到该值时进行resize扩容操作
int threshold;

/**
 * The load factor for the hash table.
 *
 * @serial
 */
// 加载因子
final float loadFactor;

/**
 * The number of times this HashMap has been structurally modified
 * Structural modifications are those that change the number of mappings in
 * the HashMap or otherwise modify its internal structure (e.g.,
 * rehash).  This field is used to make iterators on Collection-views of
 * the HashMap fail-fast.  (See ConcurrentModificationException).
 */
// 累计HashMap结构修改的次数，用来迭代器在判断并发修改时快速失败
transient int modCount;
</code></pre><p><strong>HashMap的默认构造函数</strong></p>
<pre><code>public HashMap() {
    // 采用默认值进行构造
    this.loadFactor = DEFAULT_LOAD_FACTOR;
    threshold = (int)(DEFAULT_INITIAL_CAPACITY * DEFAULT_LOAD_FACTOR);
    table = new Entry[DEFAULT_INITIAL_CAPACITY];
    init();
}

// 用来给子类在构造后进行拓展的方法
void init() {
}
</code></pre><p><strong>hash方法</strong></p>
<pre><code>/**
 * Applies a supplemental hash function to a given hashCode, which
 * defends against poor quality hash functions.  This is critical
 * because HashMap uses power-of-two length hash tables, that
 * otherwise encounter collisions for hashCodes that do not differ
 * in lower bits. Note: Null keys always map to hash 0, thus index 0.
 */
static int hash(int h) {
    // This function ensures that hashCodes that differ only by
    // constant multiples at each bit position have a bounded
    // number of collisions (approximately 8 at default load factor).
    h ^= (h &gt;&gt;&gt; 20) ^ (h &gt;&gt;&gt; 12);
    return h ^ (h &gt;&gt;&gt; 7) ^ (h &gt;&gt;&gt; 4);
}

/**
 * Returns index for hash code h.
 */
// 用来定位把key 放到哪个hash桶中
static int indexFor(int h, int length) {
    // 等价于 h % (length -1) 
    return h &amp; (length-1);
}
</code></pre><p><strong>put方法</strong></p>
<pre><code>/**
 * Associates the specified value with the specified key in this map.
 * If the map previously contained a mapping for the key, the old
 * value is replaced.
 *
 * @param key key with which the specified value is to be associated
 * @param value value to be associated with the specified key
 * @return the previous value associated with &lt;tt&gt;key&lt;/tt&gt;, or
 *         &lt;tt&gt;null&lt;/tt&gt; if there was no mapping for &lt;tt&gt;key&lt;/tt&gt;.
 *         (A &lt;tt&gt;null&lt;/tt&gt; return can also indicate that the map
 *         previously associated &lt;tt&gt;null&lt;/tt&gt; with &lt;tt&gt;key&lt;/tt&gt;.)
 */
public V put(K key, V value) {
    // key 为null
    if (key == null)
        return putForNullKey(value);

    // 获取key的hash值
    int hash = hash(key.hashCode());
    // 根据hash值计算当前key 对应的hash桶index
    int i = indexFor(hash, table.length);

    // 遍历hash桶的链表
    for (Entry&lt;K,V&gt; e = table[i]; e != null; e = e.next) {
        Object k;

        // 判断hash值相等，并且 (是同一个key 或 key.equals(k) ）
        // 这也就是为什么把对象放进HashMap时，需要实现 hashCode 与 equals方法
        if (e.hash == hash &amp;&amp; ((k = e.key) == key || key.equals(k))) {
            // 该key已存在，则更新value，并返回记录oldValue
            V oldValue = e.value;
            e.value = value;
            e.recordAccess(this);// 记录该项被访问过
            return oldValue;
        }
    }

    // 修改数加1
    modCount++; // modCount不是volatile修饰的，且自增操作无法保证线程安全！！！

    // key不存在Map中，则添加该项
    addEntry(hash, key, value, i);
    return null;
}

/**
 * Offloaded version of put for null keys
 */
private V putForNullKey(V value) {
    for (Entry&lt;K,V&gt; e = table[0]; e != null; e = e.next) {
        if (e.key == null) {
            V oldValue = e.value;
            e.value = value;
            e.recordAccess(this);
            return oldValue;
        }
    }
    modCount++;
    addEntry(0, null, value, 0);
    return null;
}
</code></pre><p><strong>addEntry方法</strong></p>
<pre><code>// 添加一个Entry
void addEntry(int hash, K key, V value, int bucketIndex) {
    // 获取相应的hash桶
    Entry&lt;K,V&gt; e = table[bucketIndex];
    // 修改hash桶的head头指针为新建的Entry
    // 旧的head则作为构造函数传入Entry,新建Entry的next将指向旧的head.
    table[bucketIndex] = new Entry&lt;K,V&gt;(hash, key, value, e);

    if (size++ &gt;= threshold)
        // 如果大小大于或等于阈值，则进行resize重新hash操作
        resize(2 * table.length);// 增长为原来大小的2倍

    // 如果恶意制造大量相同hash桶index的值，则会将HashMap退化为链表
    // 从而产生HashMap碰撞攻击
}
</code></pre><p><strong>Entry相当于链表中的一个节点（Node）</strong><br>Entry类的成员与构建函数:</p>
<pre><code>static class Entry&lt;K,V&gt; implements Map.Entry&lt;K,V&gt; {
    final K key;
    V value;
    Entry&lt;K,V&gt; next;
    final int hash;

    /**
     * Creates new entry.
     */
    Entry(int h, K k, V v, Entry&lt;K,V&gt; n) {
        value = v;
        next = n;
        key = k;
        hash = h;
    }
</code></pre><p><strong>resize方法</strong></p>
<pre><code>void resize(int newCapacity) {
    Entry[] oldTable = table;
    int oldCapacity = oldTable.length;
    // 如果已经达到最大容量上限，则调整threshold为整数的最大值，然后返回
    if (oldCapacity == MAXIMUM_CAPACITY) {
        threshold = Integer.MAX_VALUE;
        return;
    }

    // 创建一个新容器大小的hash桶
    Entry[] newTable = new Entry[newCapacity];
    transfer(newTable);
    table = newTable;
    // 重新计算阈值
    threshold = (int)(newCapacity * loadFactor);
}

/**
 * Transfers all entries from current table to newTable.
 */
// 迁移所有的旧hash桶的entry到新的hash桶内
void transfer(Entry[] newTable) {
    Entry[] src = table;
    int newCapacity = newTable.length;
    // 遍历每个hash桶
    for (int j = 0; j &lt; src.length; j++) {
        Entry&lt;K,V&gt; e = src[j];
        // hash链表不为空
        if (e != null) {
            src[j] = null;// 将src的hash桶的头指针置空

            do {// 遍历hash链表

                Entry&lt;K,V&gt; next = e.next;
                // 计算在新hash桶中的桶索引
                int i = indexFor(e.hash, newCapacity);
                // 与addEntry一样，修改Entry的next
                e.next = newTable[i];
                // 使hash桶的头指针指向entry
                newTable[i] = e;

                e = next;// 遍历下一项
            } while (e != null);
        }
    }
}
</code></pre><p><strong>迭代器的实现</strong></p>
<pre><code>public Set&lt;Map.Entry&lt;K,V&gt;&gt; entrySet() {
    return entrySet0();
}

private Set&lt;Map.Entry&lt;K,V&gt;&gt; entrySet0() {
    Set&lt;Map.Entry&lt;K,V&gt;&gt; es = entrySet;
    return es != null ? es : (entrySet = new EntrySet());
}

private final class EntrySet extends AbstractSet&lt;Map.Entry&lt;K,V&gt;&gt; {
    public Iterator&lt;Map.Entry&lt;K,V&gt;&gt; iterator() {
        return newEntryIterator();
    }
    public boolean contains(Object o) {
        if (!(o instanceof Map.Entry))
            return false;
        Map.Entry&lt;K,V&gt; e = (Map.Entry&lt;K,V&gt;) o;
        Entry&lt;K,V&gt; candidate = getEntry(e.getKey());
        return candidate != null &amp;&amp; candidate.equals(e);
    }
    public boolean remove(Object o) {
        return removeMapping(o) != null;
    }
    public int size() {
        return size;
    }
    public void clear() {
        HashMap.this.clear();
    }
}

Iterator&lt;Map.Entry&lt;K,V&gt;&gt; newEntryIterator()   {
    return new EntryIterator();
}

private final class EntryIterator extends HashIterator&lt;Map.Entry&lt;K,V&gt;&gt; {
    public Map.Entry&lt;K,V&gt; next() {
        return nextEntry();
    }
}


private abstract class HashIterator&lt;E&gt; implements Iterator&lt;E&gt; {
    Entry&lt;K,V&gt; next;        // next entry to return
    int expectedModCount;   // For fast-fail
    int index;              // current slot
    Entry&lt;K,V&gt; current;     // current entry

    HashIterator() {
        // 初始化为保存当前的modCount
        expectedModCount = modCount;
        if (size &gt; 0) { // advance to first entry
            Entry[] t = table;
            // 遍历hash桶，获取第一个不为空的hash桶
            while (index &lt; t.length &amp;&amp; (next = t[index++]) == null)
                ;
        }
    }

    public final boolean hasNext() {
        return next != null;
    }

    final Entry&lt;K,V&gt; nextEntry() {
        // 如果expectedModCount 与 modCount 不一致，则说明其它地方对Map进行了修改
        if (modCount != expectedModCount)
            throw new ConcurrentModificationException();

        Entry&lt;K,V&gt; e = next;
        if (e == null)
            throw new NoSuchElementException();

        // 如果当前项的next为空，则找到一个不为空的项，如果没有则为null
        if ((next = e.next) == null) {
            Entry[] t = table;
            while (index &lt; t.length &amp;&amp; (next = t[index++]) == null)
                ;
        }

        // 返回当前项
        current = e;
        return e;
    }

    public void remove() {
        if (current == null)
            throw new IllegalStateException();
        if (modCount != expectedModCount)
            throw new ConcurrentModificationException();
        Object k = current.key;
        current = null;
        HashMap.this.removeEntryForKey(k);
        expectedModCount = modCount;
    }

}
</code></pre><h4 id="注意事项"><a href="#注意事项" class="headerlink" title="注意事项"></a>注意事项</h4><ol>
<li>HashMap不是线程安全的。</li>
<li>迭代器的快速失败行为不能得到保证。<br>一般来说，存在非同步的并发修改时，不可能作出任何坚决的保证。快速失败迭代器尽最大努力抛出 ConcurrentModificationException。因此，<strong>编写依赖于此异常的程序的做法是错误的</strong>，正确做法是：迭代器的快速失败行为应该仅用于检测程序错误。  </li>
<li>如果你有一个已知大小的HashMap,初始化时最好带上容量参数，以避免频繁进行resize操作。</li>
<li>HashMap碰撞拒绝服务漏洞<br>Apache的方案是在Tomcat中增加一个新的选项maxParameterCount，用来限制单个请求中的最大参数量。参数默认值设为10000，确保既不会对应用程序造成影响（对多数应用来说已经足够），也足以减轻DoS攻击的压力。 </li>
</ol>
<p>####参考资料</p>
<ul>
<li><a href="http://www.iteye.com/news/23859" target="_blank" rel="noopener">Apache曝HashTable碰撞拒绝服务漏洞，Java、PHP、Asp.Net及v8引擎等都受影响</a></li>
</ul>

      
    </div>
    <footer class="article-footer2">
      <div id="footer-info" class="inner">
        <a href="http://www.618shoe.com/">莆田1:1精仿鞋微信号</a>
        <a href="http://www.618shoe.com/">莆田高仿鞋子的价格表</a>
        <a href="http://www.618shoe.com/">关于莆田仿鞋</a>
        <a href="http://www.618shoe.com/">莆田高仿鞋淘宝店店名</a>
        <a href="http://www.618shoe.com/">莆田精仿鞋官网</a>
         咨询QQ：<a title="点击这里给我发消息" href="http://wpa.qq.com/msgrd?v=3&amp;uin=2727291807&amp;site=www.cactussoft.cn&amp;menu=yes" target="_blank"><img src="http://wpa.qq.com/pa?p=2:2727291807:41"></a>
      </div>
        <div id="footer-info" class="inner">
          <a href="http://www.618shoe.com/">莆田高仿鞋批发</a>&nbsp;&nbsp;
          <a href="http://www.618shoe.com/">1：1高仿鞋批发</a>&nbsp;&nbsp;
          <a href="http://www.618shoe.com/">高仿鞋批发市场</a>&nbsp;&nbsp;
          <a href="http://www.618shoe.com/">高仿鞋网</a>&nbsp;&nbsp;
          <a href="http://www.618shoe.com/">广州高仿鞋批发</a>&nbsp;&nbsp;
          <a href="http://www.618shoe.com/">外贸尾单鞋批发</a>&nbsp;&nbsp;
          <a href="http://www.618shoe.com/">精仿鞋专线</a>&nbsp;&nbsp;
      </div>
      <div id="footer-info" class="inner">
             <a href="http://www.618shoe.com/">莆田高仿鞋批发</a>&nbsp;&nbsp;
             公司网站:&nbsp;&nbsp;<a href="http://www.618shoe.com//" target="_blank">http://www.618shoe.com/</a>&nbsp;&nbsp;
             <a href="http://www.618shoe.com/">高仿鞋批发市场</a>
             微信 <img src="/pics/qrcode.jpg" style="width:100px;height:100px;">
      </div>
    </footer>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/blog/2013/03/05/hashmap-in-java/" data-id="cja9reqtx001qif5im4zggrph" class="article-share-link">Partager</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-object-initialization-in-java" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/blog/2013/03/02/object-initialization-in-java/" class="article-date">
  <time datetime="2013-03-02T02:24:00.000Z" itemprop="datePublished">2013-03-02</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Java/">Java</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/blog/2013/03/02/object-initialization-in-java/">Java中的对象初始化</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h5 id="1-一般类的初始化顺序"><a href="#1-一般类的初始化顺序" class="headerlink" title="1. 一般类的初始化顺序"></a>1. 一般类的初始化顺序</h5><ul>
<li>加载类</li>
<li>设置所有的静态成员为默认值(0,false,0.0 etc.)，引用类型初始化null</li>
<li>按照在类声明中出现的次序，依次执行静态成员或静态块的初始化。静态初始化只在Class对象首次加载的时候进行一次。</li>
<li>new Class() 创建一个实例对象时,首先在堆上为<strong>实例对象</strong>分配足够的存储空间。</li>
<li>这块存储空间会清零，自动将<strong>实例对象</strong>的所有基本类型数据都设置成默认值，而引用类型被设置为null.</li>
<li>初始化类的实例成员，实例成员间的初始化顺序取决于在类的中声明顺序。</li>
<li>执行构造方法</li>
</ul>
<h5 id="2-继承结构的初始化顺序"><a href="#2-继承结构的初始化顺序" class="headerlink" title="2. 继承结构的初始化顺序"></a>2. 继承结构的初始化顺序</h5><ul>
<li>先执行父类的静态成员初始化</li>
<li>执行子类的静态成员初始化</li>
<li>执行父类的实例成员初始化</li>
<li>再执行父类的构造函数</li>
<li>执行子类的实例成员初始化</li>
<li>执行子类的构造函数</li>
</ul>
<p>code:</p>
<pre><code>class Who{

    public Who(String name){
        System.out.println(name + &quot; is here!&quot;);
    }

}



class Child extends Parent{

    Who w3 = new Who(&quot;Child instance&quot;);

    static{
        System.out.println(&quot;Child static block 1&quot;);
    }

    static Who w4 = new Who(&quot;Child static&quot;);

    static{
        System.out.println(&quot;Child static block 2&quot;);
    }

    public Child(){
        System.out.println(&quot;Child construct&quot;);
    }

}


class Parent{

    Who w2 = new Who(&quot;Parent instance&quot;);

    static{
        System.out.println(&quot;Parent static block 1&quot;);
    }

    static Who w1 = new Who(&quot;Parent static&quot;);

    static{
        System.out.println(&quot;Parent static block 2&quot;);
    }

    public Parent(){
        System.out.println(&quot;Parent construct&quot;);
    }

}

public class Test {
    public static void main(String[] args) {
        new Child();
    }
}
</code></pre><p><strong>输出：</strong></p>
<pre><code>Parent static block 1
Parent static is here!
Parent static block 2
Child static block 1
Child static is here!
Child static block 2
Parent instance is here!
Parent construct
Child instance is here!
Child construct
</code></pre><h5 id="3-类的静态块中，启动一个线程（线程中包含类的静态变量）"><a href="#3-类的静态块中，启动一个线程（线程中包含类的静态变量）" class="headerlink" title="3. 类的静态块中，启动一个线程（线程中包含类的静态变量）"></a>3. 类的静态块中，启动一个线程（线程中包含类的静态变量）</h5><pre><code>class Foo {

    public Foo(int i) {
        System.out.println(&quot;foo&quot; + i + &quot; construct &quot;);
    }
}

class Example {

    static {
        System.out.println(&quot;static block 1 &quot;);
        // compile error
        // System.out.println(&quot;Print &quot; + foo);

        new Thread(new Runnable() {

            @Override
            public void run() {
                System.out.println(&quot;Thread1 &quot;);
                // System.out.println(&quot;Thread run whith foo2 &quot; + foo2);
            }
        }).start();
    }


    static {
        System.out.println(&quot;static block 2 &quot;);

        new Thread(new Runnable() {

            @Override
            public void run() {
                System.out.println(&quot;Thread2 run whith foo &quot; + foo);
                // System.out.println(&quot;Thread run whith foo2 &quot; + foo2);
            }
        }).start();

        try {
            System.out.println(&quot;main thread sleep &quot;);
            Thread.sleep(1000 * 5);
        } catch (InterruptedException e) {
            e.printStackTrace();
        }
    }

    static Foo foo = new Foo(1);

    final Foo foo2 = new Foo(2);

    static {
        System.out.println(&quot;static block 3 &quot;);
    }

    public Example() {
        System.out.println(&quot;Example construct&quot;);
    }

}

public class Test2 {

    public static void main(String[] args) {
        new Example();
    }
}
</code></pre><p><strong>输出：</strong></p>
<pre><code>static block 1 
static block 2 
main thread sleep 
Thread1 
foo1 construct 
static block 3 
foo2 construct 
Example construct
Thread2 run whith foo Foo@10c042ab
</code></pre><p><strong>结论：</strong>  </p>
<ol>
<li>可见如果静态块中创建的线程，如果引用类的静态成员，会等到类的静态成员初始化完成后再执行该线程。</li>
</ol>
<p>#####5. stackoverflow 上的奇葩问题</p>
<pre><code>import java.util.ArrayList;
import java.util.List;

public class Test3 {
    public static void main(String[] args) {
        SomeClass.getInstance();
    }
}

class SomeClass {

    private static final SomeClass instance = new SomeClass();

    public static SomeClass getInstance() {
        return instance;
    }

    static {
        System.out.println(&quot;Someclass static init&quot;);
    }
    private static String objectName1 = &quot;test1&quot;;
    private static String objectName2 = &quot;test2&quot;;

    @SuppressWarnings(&quot;serial&quot;)
    private List&lt;SomeObject&gt; list = new ArrayList&lt;SomeObject&gt;() {
        {
            add(new SomeObject(objectName1));
            add(new SomeObject(objectName2));
        }
    };

    public SomeClass(){
        System.out.println(&quot;some class construct&quot;);
        System.out.println(&quot;list is &quot; + list);
    }
}

class SomeObject {

    String name;

    SomeObject(String name) {
        this.name = name;
        System.out.println(&quot;my name is:&quot; + name);
    }
}
</code></pre><p><strong>输出：</strong></p>
<pre><code>my name is:null
my name is:null
some class construct
list is [SomeObject@780adb3f, SomeObject@10c042ab]
Someclass static init
</code></pre><p><strong>牛人解答：</strong></p>
<blockquote>
<p>Static blocks are initialized in order (so you can rely on the ones above in the ones below). By creating an instance of SomeClass as your first static initializer in SomeClass, you’re forcing an instance init during the static init phase.</p>
<p>So the logical order of execution of your code is:</p>
<ul>
<li>Load class SomeClass, all static fields initially defaults (0, null, etc.)</li>
<li>Begin static inits</li>
<li>First static init creates instance of SomeClass</li>
<li>Begin instance inits for SomeClass instance, using current values for static fields (so objectName1 and objectName2 are null)</li>
<li>Load SomeObject class, all static fields initially default (you don’t have any)</li>
<li>Do SomeObject static inits (you don’t have any)</li>
<li>Create instances of SomeObject using the passed-in null values</li>
<li>Continue static inits of SomeClass, setting objectName1 and objectName2</li>
</ul>
<p>To make this work as you may expect, simply put the inits for objectName1 and objectName2 above the init for instance.</p>
</blockquote>
<hr>
<p>As suggested moving this line:</p>
<pre><code>private static final SomeClass  instance    = new SomeClass();
</code></pre><p>after these:</p>
<pre><code>private  static String objectName1  =&quot;test1&quot;;
private  static String objectName2  =&quot;test2&quot;;
</code></pre><p>should fix the problem.</p>
<p>#####6. 多线程初始化</p>
<p><strong>类的初始化</strong>阶段是执行类构造器<code>&lt;clinit&gt;()</code>方法的过程。  </p>
<ul>
<li>&lt;clinit&gt;()方法是由编译器自动收集类中的所有类变量的赋值动作和静态语句块（static{}块）中的语句合并产生的，编译器收集的顺序是由语句在源文件中出现的顺序决定。</li>
<li>虚拟机会保证在子类的&lt;clinit&gt;()方法执行之前，父类的&lt;clinit&gt;()已经执行完毕。</li>
<li>由于父类的&lt;clinit&gt;()方法先执行，也就意味着父类中定义的静态语句块要优先于子类的变量赋值操作。</li>
<li>如果一个类没有静态语句块，也没有对变更的赋值操作，那么编译器可以不为这个类生成&lt;clinit&gt;()。</li>
<li>接口中不能使用静态语句块，但仍然有变量初始化的赋值操作，因此接口与类一样会生成&lt;clinit&gt;()方法。</li>
<li>虚拟机会操作一个类的&lt;clinit&gt;()方法在多线程环境中被正确的回销和同步。多个线程同时初始化一个对象，那么只会有一个线程去执行这个类的&lt;clinit&gt;()方法。</li>
</ul>
<p>示例：</p>
<pre><code>public class DeadLoopDemo{

    static{

        if(true){
            System.out.println(Thread.currentThread() + &quot;init DeadLoopDemo&quot;);
            while (true) {

            }
        }
    }

    public static void main(String[] args) {

        Runnable runable = new Runnable() {

            @Override
            public void run() {
                // TODO Auto-generated method stub
                System.out.println(Thread.currentThread() + &quot;start&quot;);
                DeadLoopDemo d1 = new DeadLoopDemo();
                System.out.println(Thread.currentThread() + &quot;stop&quot;);

            }
        };

        Thread t1 = new Thread(runable);
        Thread t2 = new Thread(runable);
        t1.start();
        t2.start();
    }
}
</code></pre><p>####参考资料  </p>
<ul>
<li><a href="http://www.artima.com/designtechniques/initializationP.html" target="_blank" rel="noopener">Object Initialization in Java</a></li>
<li><a href="http://stackoverflow.com/questions/7687030/java-constructor-order" target="_blank" rel="noopener">java-constructor-order</a>  - Stack Overflow</li>
<li>Thinking in Java</li>
<li>《深入理解Java虚拟机》——周志明著</li>
</ul>

      
    </div>
    <footer class="article-footer2">
      <div id="footer-info" class="inner">
        <a href="http://www.618shoe.com/">莆田1:1精仿鞋微信号</a>
        <a href="http://www.618shoe.com/">莆田高仿鞋子的价格表</a>
        <a href="http://www.618shoe.com/">关于莆田仿鞋</a>
        <a href="http://www.618shoe.com/">莆田高仿鞋淘宝店店名</a>
        <a href="http://www.618shoe.com/">莆田精仿鞋官网</a>
         咨询QQ：<a title="点击这里给我发消息" href="http://wpa.qq.com/msgrd?v=3&amp;uin=2727291807&amp;site=www.cactussoft.cn&amp;menu=yes" target="_blank"><img src="http://wpa.qq.com/pa?p=2:2727291807:41"></a>
      </div>
        <div id="footer-info" class="inner">
          <a href="http://www.618shoe.com/">莆田高仿鞋批发</a>&nbsp;&nbsp;
          <a href="http://www.618shoe.com/">1：1高仿鞋批发</a>&nbsp;&nbsp;
          <a href="http://www.618shoe.com/">高仿鞋批发市场</a>&nbsp;&nbsp;
          <a href="http://www.618shoe.com/">高仿鞋网</a>&nbsp;&nbsp;
          <a href="http://www.618shoe.com/">广州高仿鞋批发</a>&nbsp;&nbsp;
          <a href="http://www.618shoe.com/">外贸尾单鞋批发</a>&nbsp;&nbsp;
          <a href="http://www.618shoe.com/">精仿鞋专线</a>&nbsp;&nbsp;
      </div>
      <div id="footer-info" class="inner">
             <a href="http://www.618shoe.com/">莆田高仿鞋批发</a>&nbsp;&nbsp;
             公司网站:&nbsp;&nbsp;<a href="http://www.618shoe.com//" target="_blank">http://www.618shoe.com/</a>&nbsp;&nbsp;
             <a href="http://www.618shoe.com/">高仿鞋批发市场</a>
             微信 <img src="/pics/qrcode.jpg" style="width:100px;height:100px;">
      </div>
    </footer>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/blog/2013/03/02/object-initialization-in-java/" data-id="cja9reqtv001mif5ik8quvmgr" class="article-share-link">Partager</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-eclipse-install-guide" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/blog/2012/12/24/eclipse-install-guide/" class="article-date">
  <time datetime="2012-12-24T13:24:00.000Z" itemprop="datePublished">2012-12-24</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/DevTools-Eclipse/">DevTools Eclipse</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/blog/2012/12/24/eclipse-install-guide/">eclipse install guide</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p><a href="http://www.eclipse.org/downloads/" target="_blank" rel="noopener">Eclipse官网</a>下载最新版的Eclipse JavaEE 版本安装。</p>
<p>默认自带插件：  </p>
<ol>
<li>Maven Integration for Eclipse   </li>
<li>EGit - Git Team Provider  </li>
</ol>
<p>必备插件  </p>
<ol>
<li>Subversive - SVN Team Provider  </li>
<li>EasyShell  </li>
<li>AnyEdit Tools  </li>
<li>Gradle Integration for Eclipse   </li>
</ol>
<p>可选  </p>
<ol>
<li>Findbugs Eclipse Plugin  </li>
<li>CheckStyle</li>
</ol>
<p>其它<br>scala插件 <a href="http://scala-ide.org/download/current.html" target="_blank" rel="noopener">http://scala-ide.org/download/current.html</a></p>
<p>参考资料</p>
<ul>
<li><a href="http://www.fromdev.com/2012/01/25-best-free-eclipse-plug-ins-for-java.html" target="_blank" rel="noopener">27 Best Free Eclipse Plug-ins for Java Developer to be Productive</a></li>
</ul>

      
    </div>
    <footer class="article-footer2">
      <div id="footer-info" class="inner">
        <a href="http://www.618shoe.com/">莆田1:1精仿鞋微信号</a>
        <a href="http://www.618shoe.com/">莆田高仿鞋子的价格表</a>
        <a href="http://www.618shoe.com/">关于莆田仿鞋</a>
        <a href="http://www.618shoe.com/">莆田高仿鞋淘宝店店名</a>
        <a href="http://www.618shoe.com/">莆田精仿鞋官网</a>
         咨询QQ：<a title="点击这里给我发消息" href="http://wpa.qq.com/msgrd?v=3&amp;uin=2727291807&amp;site=www.cactussoft.cn&amp;menu=yes" target="_blank"><img src="http://wpa.qq.com/pa?p=2:2727291807:41"></a>
      </div>
        <div id="footer-info" class="inner">
          <a href="http://www.618shoe.com/">莆田高仿鞋批发</a>&nbsp;&nbsp;
          <a href="http://www.618shoe.com/">1：1高仿鞋批发</a>&nbsp;&nbsp;
          <a href="http://www.618shoe.com/">高仿鞋批发市场</a>&nbsp;&nbsp;
          <a href="http://www.618shoe.com/">高仿鞋网</a>&nbsp;&nbsp;
          <a href="http://www.618shoe.com/">广州高仿鞋批发</a>&nbsp;&nbsp;
          <a href="http://www.618shoe.com/">外贸尾单鞋批发</a>&nbsp;&nbsp;
          <a href="http://www.618shoe.com/">精仿鞋专线</a>&nbsp;&nbsp;
      </div>
      <div id="footer-info" class="inner">
             <a href="http://www.618shoe.com/">莆田高仿鞋批发</a>&nbsp;&nbsp;
             公司网站:&nbsp;&nbsp;<a href="http://www.618shoe.com//" target="_blank">http://www.618shoe.com/</a>&nbsp;&nbsp;
             <a href="http://www.618shoe.com/">高仿鞋批发市场</a>
             微信 <img src="/pics/qrcode.jpg" style="width:100px;height:100px;">
      </div>
    </footer>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/blog/2012/12/24/eclipse-install-guide/" data-id="cja9reqts001hif5ihqkxjk0t" class="article-share-link">Partager</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-java-vm-args" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/blog/2012/12/24/java-vm-args/" class="article-date">
  <time datetime="2012-12-24T07:42:00.000Z" itemprop="datePublished">2012-12-24</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Java-JVM/">Java JVM</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/blog/2012/12/24/java-vm-args/">java vm args</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h4 id="1-java-标准参数"><a href="#1-java-标准参数" class="headerlink" title="1.java 标准参数"></a>1.java 标准参数</h4><pre>
C:\Users\Administrator>java -h
用法: java [-options] class [args...]
           (执行类)
   或  java [-options] -jar jarfile [args...]
           (执行 jar 文件)
其中选项包括:
    -d32          使用 32 位数据模型 (如果可用)
    -d64          使用 64 位数据模型 (如果可用)
    -server       选择 "server" VM
    -hotspot      是 "server" VM 的同义词 [已过时]
                  默认 VM 是 server.

    -cp <目录和 zip="" jar="" 文件的类搜索路径="">
    -classpath <目录和 zip="" jar="" 文件的类搜索路径="">
                  用 ; 分隔的目录, JAR 档案
                  和 ZIP 档案列表, 用于搜索类文件。
    -D<name>=<value>
                  设置系统属性
    -verbose[:class|gc|jni]
                  启用详细输出
    -version      输出产品版本并退出
    -version:<value>
                  需要指定的版本才能运行
    -showversion  输出产品版本并继续
    -jre-restrict-search | -no-jre-restrict-search
                  在版本搜索中包括/排除用户专用 JRE
    -? -help      输出此帮助消息
    -X            输出非标准选项的帮助
    -ea[:<packagename>...|:<classname>]
    -enableassertions[:<packagename>...|:<classname>]
                  按指定的粒度启用断言
    -da[:<packagename>...|:<classname>]
    -disableassertions[:<packagename>...|:<classname>]
                  禁用具有指定粒度的断言
    -esa | -enablesystemassertions
                  启用系统断言
    -dsa | -disablesystemassertions
                  禁用系统断言
    -agentlib:<libname>[=<options>]
                  加载本机代理库 <libname>, 例如 -agentlib:hprof
                  另请参阅 -agentlib:jdwp=help 和 -agentlib:hprof=help
    -agentpath:<pathname>[=<options>]
                  按完整路径名加载本机代理库
    -javaagent:<jarpath>[=<options>]
                  加载 Java 编程语言代理, 请参阅 java.lang.instrument
    -splash:<imagepath>
                  使用指定的图像显示启动屏幕
有关详细信息, 请参阅 http://www.oracle.com/technetwork/java/javase/documentation/index.html。

#### 2. java 非标准参数

C:\Users\Administrator>java -X
    -Xmixed           混合模式执行 (默认)
    -Xint             仅解释模式执行
    -Xbootclasspath:<用 ;="" 分隔的目录和="" zip="" jar="" 文件="">
                      设置搜索路径以引导类和资源
    -Xbootclasspath/a:<用 ;="" 分隔的目录和="" zip="" jar="" 文件="">
                      附加在引导类路径末尾
    -Xbootclasspath/p:<用 ;="" 分隔的目录和="" zip="" jar="" 文件="">
                      置于引导类路径之前
    -Xdiag            显示附加诊断消息
    -Xnoclassgc       禁用类垃圾收集
    -Xincgc           启用增量垃圾收集
    -Xloggc:<file>    将 GC 状态记录在文件中 (带时间戳)
    -Xbatch           禁用后台编译
    -Xms<size>        设置初始 Java 堆大小
    -Xmx<size>        设置最大 Java 堆大小
    -Xss<size>        设置 Java 线程堆栈大小
    -Xprof            输出 cpu 配置文件数据
    -Xfuture          启用最严格的检查, 预期将来的默认值
    -Xrs              减少 Java/VM 对操作系统信号的使用 (请参阅文档)
    -Xcheck:jni       对 JNI 函数执行其他检查
    -Xshare:off       不尝试使用共享类数据
    -Xshare:auto      在可能的情况下使用共享类数据 (默认)
    -Xshare:on        要求使用共享类数据, 否则将失败。
    -XshowSettings    显示所有设置并继续
    -XshowSettings:all
                      显示所有设置并继续
    -XshowSettings:vm 显示所有与 vm 相关的设置并继续
    -XshowSettings:properties
                      显示所有属性设置并继续
    -XshowSettings:locale
                      显示所有与区域设置相关的设置并继续

-X 选项是非标准选项, 如有更改, 恕不另行通知。

</size></size></size></file></用></用></用></imagepath></options></jarpath></options></pathname></libname></options></libname></classname></packagename></classname></packagename></classname></packagename></classname></packagename></value></value></name></目录和></目录和></pre>


<h4 id="3-java参数与默认值"><a href="#3-java参数与默认值" class="headerlink" title="3. java参数与默认值"></a>3. java参数与默认值</h4><pre><code>使用 -XX:+PrintFlagsFinal 参数可以输出所有参数的名称及默认值。  
java -XX:+PrintFlagsFinal
</code></pre><h4 id="4-JVM-常用的参数、Flags"><a href="#4-JVM-常用的参数、Flags" class="headerlink" title="4. JVM 常用的参数、Flags"></a>4. JVM 常用的参数、Flags</h4><p>参数：  </p>
<pre><code>-server       选择 &quot;server&quot; VM
-cp &lt;目录和 zip/jar 文件的类搜索路径&gt;
-classpath &lt;目录和 zip/jar 文件的类搜索路径&gt;
              用 ; 分隔的目录, JAR 档案
              和 ZIP 档案列表, 用于搜索类文件。
-D&lt;name&gt;=&lt;value&gt;
              设置系统属性
-verbose[:class|gc|jni]
              启用详细输出
-version      输出产品版本并退出
-agentlib:&lt;libname&gt;[=&lt;options&gt;]
              加载本机代理库 &lt;libname&gt;, 例如 -agentlib:hprof
              另请参阅 -agentlib:jdwp=help 和 -agentlib:hprof=help
-agentpath:&lt;pathname&gt;[=&lt;options&gt;]
              按完整路径名加载本机代理库
-javaagent:&lt;jarpath&gt;[=&lt;options&gt;]
              加载 Java 编程语言代理, 请参阅 java.lang.instrument

-Xloggc:&lt;file&gt;    将 GC 状态记录在文件中 (带时间戳)
-Xms&lt;size&gt;        设置初始 Java 堆大小
-Xmx&lt;size&gt;        设置最大 Java 堆大小
-Xmn&lt;size&gt;        设置Java堆 新生代大小
-Xss&lt;size&gt;        设置 Java 线程堆栈大小 (对应Flag:ThreadStackSize 默认1MB JDK1.5+)
-Xnoclassgc       禁用类垃圾收集
</code></pre><p>Flags:</p>
<pre><code>-XX:PermSize 指定永久代大小
-XX:MaxPermSize 指定最大永久代大小
-XX:SurvivorRatio 新生代中Eden与Survivor 的比例

-XX:GCTimeRatio   GC时间占总时间的比率，仅使用Parallel Scavenge 收集器时有效
-Xnoclassgc       禁用类垃圾收集

-XX:+DisableExplicitGC 忽略来自System.gc()方法触发的垃圾收集。
-XX:+UseParNewGC      
-XX:+UseConcMarkSweepGC
-XX:+CMSPermGenSweepingEnabled
-XX:+UseCMSCompactAtFullCollection
-XX:CMSFullGCsBeforeCompaction=0
-XX:+CMSClassUnloadingEnabled
-XX:-CMSParallelRemarkEnabled
-XX:CMSInitiatingOccupancyFraction=70
-XX:SoftRefLRUPolicyMSPerMB=0

-XX:+PrintClassHistogram
-XX:+PrintGCDetails
-XX:+PrintGCTimeStamps
-XX:+PrintGCApplicationConcurrentTime
-XX:+PrintGCApplicationStoppedTime
-Xloggc:/opt/logs/&lt;services&gt;/gc.log

调试选项
-XX:+HeapDumpOnOutofMemoryError    
-XX:+PrintFlagsFinal 
</code></pre><h4 id="5-一个标准的8核CPU的JVM服务配置"><a href="#5-一个标准的8核CPU的JVM服务配置" class="headerlink" title="5. 一个标准的8核CPU的JVM服务配置"></a>5. 一个标准的8核CPU的JVM服务配置</h4><pre><code>* 内存配置为2g，web服务推荐为4G，RMI服务如果没有大量数据缓存，推荐2G以上
* gc日志必须打开

-server
-Xms2048M
-Xmx2048M
-Xmn512M
-XX:PermSize=256M
-XX:MaxPermSize=256M
-XX:SurvivorRatio=8
-XX:MaxTenuringThreshold=7
-Xss1m
-XX:GCTimeRatio=19
-Xnoclassgc
-XX:+DisableExplicitGC
-XX:+UseParNewGC
-XX:+UseConcMarkSweepGC
-XX:+CMSPermGenSweepingEnabled
-XX:+UseCMSCompactAtFullCollection
-XX:CMSFullGCsBeforeCompaction=0
-XX:+CMSClassUnloadingEnabled
-XX:-CMSParallelRemarkEnabled
-XX:CMSInitiatingOccupancyFraction=70
-XX:SoftRefLRUPolicyMSPerMB=0
-XX:+PrintClassHistogram
-XX:+PrintGCDetails
-XX:+PrintGCTimeStamps
-XX:+PrintGCApplicationConcurrentTime
-XX:+PrintGCApplicationStoppedTime
-Xloggc:/opt/logs/&lt;services&gt;/gc.log
</code></pre><p><strong>高级JVM参数</strong>  </p>
<pre><code>-XX:HeapDumpPath=/tmp/dis-search.hprof  
-XX:+HeapDumpOnOutOfMemoryError
</code></pre><p>####<strong>参考资料</strong></p>
<ul>
<li><a href="http://docs.oracle.com/javase/1.4.2/docs/tooldocs/solaris/java.html" target="_blank" rel="noopener">java - the Java application launcher</a></li>
<li><a href="http://www.oracle.com/technetwork/java/javase/tech/vmoptions-jsp-140102.html" target="_blank" rel="noopener">Java HotSpot VM Options</a></li>
</ul>

      
    </div>
    <footer class="article-footer2">
      <div id="footer-info" class="inner">
        <a href="http://www.618shoe.com/">莆田1:1精仿鞋微信号</a>
        <a href="http://www.618shoe.com/">莆田高仿鞋子的价格表</a>
        <a href="http://www.618shoe.com/">关于莆田仿鞋</a>
        <a href="http://www.618shoe.com/">莆田高仿鞋淘宝店店名</a>
        <a href="http://www.618shoe.com/">莆田精仿鞋官网</a>
         咨询QQ：<a title="点击这里给我发消息" href="http://wpa.qq.com/msgrd?v=3&amp;uin=2727291807&amp;site=www.cactussoft.cn&amp;menu=yes" target="_blank"><img src="http://wpa.qq.com/pa?p=2:2727291807:41"></a>
      </div>
        <div id="footer-info" class="inner">
          <a href="http://www.618shoe.com/">莆田高仿鞋批发</a>&nbsp;&nbsp;
          <a href="http://www.618shoe.com/">1：1高仿鞋批发</a>&nbsp;&nbsp;
          <a href="http://www.618shoe.com/">高仿鞋批发市场</a>&nbsp;&nbsp;
          <a href="http://www.618shoe.com/">高仿鞋网</a>&nbsp;&nbsp;
          <a href="http://www.618shoe.com/">广州高仿鞋批发</a>&nbsp;&nbsp;
          <a href="http://www.618shoe.com/">外贸尾单鞋批发</a>&nbsp;&nbsp;
          <a href="http://www.618shoe.com/">精仿鞋专线</a>&nbsp;&nbsp;
      </div>
      <div id="footer-info" class="inner">
             <a href="http://www.618shoe.com/">莆田高仿鞋批发</a>&nbsp;&nbsp;
             公司网站:&nbsp;&nbsp;<a href="http://www.618shoe.com//" target="_blank">http://www.618shoe.com/</a>&nbsp;&nbsp;
             <a href="http://www.618shoe.com/">高仿鞋批发市场</a>
             微信 <img src="/pics/qrcode.jpg" style="width:100px;height:100px;">
      </div>
    </footer>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/blog/2012/12/24/java-vm-args/" data-id="cja9reqtt001kif5i0r3h5215" class="article-share-link">Partager</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-mongodb-map-reduce" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/blog/2012/12/21/mongodb-map-reduce/" class="article-date">
  <time datetime="2012-12-21T09:09:00.000Z" itemprop="datePublished">2012-12-21</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/MongoDB/">MongoDB</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/blog/2012/12/21/mongodb-map-reduce/">MongoDB MapReduce</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p><strong>MapReduce</strong>  </p>
<p>db.collection.mapReduce()的用法：</p>
<pre><code>db.collection.mapReduce(
                     &lt;mapfunction&gt;,
                     &lt;reducefunction&gt;,
                     {
                       out: &lt;collection&gt;,
                       query: &lt;document&gt;,
                       sort: &lt;document&gt;,
                       limit: &lt;number&gt;,
                       finalize: &lt;function&gt;,
                       scope: &lt;document&gt;,
                       jsMode: &lt;boolean&gt;,
                       verbose: &lt;boolean&gt;
                     }
                   )
</code></pre><p><strong>坑</strong>：  </p>
<ol>
<li>MapReduce 在map funtion 中 emit 相应的key 只有一个文档命中的时候，不会执行reduce方法，需要在finailize 方法中进行处理。  </li>
<li>reduce 方法针对相同的key 有可能多次执行，reduce 计算的结果只和当前传入的values 有关系。</li>
</ol>
<p>现有有个表topic_photos结构如下：</p>
<pre><code>{
  &quot;_id&quot; : ObjectId(&quot;50b223832115fb21eca4a485&quot;),
  &quot;created_at&quot; : ISODate(&quot;2012-11-25T13:56:19.548Z&quot;),
  &quot;last_liked&quot; : ISODate(&quot;2012-12-10T08:44:49.276Z&quot;),
  &quot;likes&quot; : 6,
  &quot;photo_id&quot; : NumberLong(&quot;39967821345988608&quot;),
  &quot;topic_id&quot; : NumberLong(&quot;38362556125028352&quot;),
  &quot;user_id&quot; : NumberLong(12449)
}
</code></pre><p>现在我们要选出被likes最多的用户，以及该用户likes最多那张照片及该照片的likes 数。</p>
<pre><code>public void groupPhotosByUser(long topicId, long startTime, long endTime){

    String map = &quot; function(){ &quot;
            + &quot;        var key = this.user_id; &quot; // 以用户的user_id 为 key
            + &quot;        value={photo_id:this.photo_id,likes:this.likes,photo_count:1,created_at:ISODate()};&quot; // value 包含photo_id,likes,photo_count 初始为1。
            + &quot;        emit(key,value); &quot;
            + &quot;    };&quot;;

    String reduce = &quot;  function (user_id, values){&quot;
                            // map reduce 是并行执行的，所以每次执行的时候都要初始化result
                    + &quot;        var result = {user_id:user_id,photo_id:0,photo_count:0,likes:0,created_at:Date()}; &quot;
                    + &quot;     for(var i=0; i&lt;values.length; i++){ &quot;
                    + &quot;         value = values[i];              &quot;
                    + &quot;         if(value &gt; result.likes){ &quot; 
                        // 选中values中likes最多的对象，并记录likes数与 photo_id
                    + &quot;             result.likes = value.likes; &quot;
                    + &quot;             result.photo_id = value.photo_id;  &quot;
                    + &quot;         } &quot;
                    + &quot;         result.photo_count += value.photo_count; &quot;
                    // 在循环中累计photo_count, 这里不是取values.length!!! 因为values个数多的时候，是分多次map_reduce执行的。
                    // 例如有20个values,可能分别reduce 10个文档，再将两次reduce的结果再次reduce,这时如果直接获取 values.length 结果就为2了。
                    + &quot;     }; &quot;
                    + &quot;      return result; &quot;
                    + &quot;}&quot;;

    String finalize = &quot; function (user_id, result) { &quot;
            + &quot;        if(typeof(result.created_at) == &apos;undefined&apos; ){ &quot; 
                    // 用户只有一张topic_photo的情况，在这里进行初始化。
            + &quot;            result = {user_id:user_id,photo_count:1,photo_id:result.photo_id,likes:result.likes,created_at:ISODate()}; &quot;
            + &quot;        } &quot;
            + &quot;      return result; &quot;
            + &quot;}&quot;;

    DBObject query = QueryBuilder.start(&quot;topic_id&quot;).is(topicId)
                    .put(&quot;created_at&quot;).greaterThanEquals(new Date(startTime))
                    .lessThanEquals(new Date(endTime))
                    .get();
    String outputCollection = String.format(&quot;topic_%s_users&quot;, topicId);

    DBCollection inputCollection = getMongoDB().getCollection(&quot;topic_photos&quot;);
    MapReduceCommand mapReduceCommand = new MapReduceCommand(inputCollection, map, reduce, outputCollection, OutputType.REPLACE, query);
    mapReduceCommand.setFinalize(finalize);
    inputCollection.mapReduce(mapReduceCommand);

    //TODO creat mongodb index
}
</code></pre><h4 id="MongoDB的调试"><a href="#MongoDB的调试" class="headerlink" title="MongoDB的调试"></a>MongoDB的调试</h4><p>Java程序中</p>
<pre><code>static{

    // Enable MongoDB logging in general
    System.setProperty(&quot;DEBUG.MONGO&quot;, &quot;true&quot;);

    // Enable DB operation tracing
    System.setProperty(&quot;DB.TRACE&quot;, &quot;true&quot;);
}    
</code></pre><p>利用printjson()函数，在MapReduce 的执行过程打印出执行日志</p>
<pre><code>var map = function(){
    var key = this.user_id;
    var value = {photo_id:this.photo_id, likes:this.likes, photo_count:1, created_at:ISODate()};
    emit(key,value);
}

var reduce = function (user_id, values){
    if (user_id == 350278) {
        printjson(values);
    }

    var result = {user_id:user_id,photo_id:0,photo_count:0,likes:0,created_at:Date()};
    for(var i=0; i&lt;values.length; i++){
        var value = values[i];
        if(value &gt; result.likes){
            result.likes = value.likes;
            result.photo_id = value.photo_id;
        }
        result.photo_count += value.photo_count;
    };
    return result;
}

var finalize = function (user_id, result) {
    if(typeof(result.created_at) == &apos;undefined&apos; ){
        result = {user_id:user_id,photo_count:1,photo_id:result.photo_id,likes:result.likes,created_at:ISODate()};
    }
    return result;
}

var query = {&quot;topic_id&quot; : 38362556125028352}

db.runCommand({&quot;mapreduce&quot; : &quot;topic_photos&quot; ,
          &quot;map&quot; : map, 
          &quot;reduce&quot; : reduce,
          &quot;finalize&quot;: finalize,
          &quot;query&quot; : query,           
          &quot;out&quot; : { &quot;replace&quot; : &quot;topic_38362556125028352_users&quot;}, 
          &quot;verbose&quot; : true
        })
</code></pre><p>MongoDB控制台输出</p>
<p><img src="/pics/mongodb-map-reduce.jpg" alt=""></p>
<p>从上图可以看到，最后一次reduce 时，是将前两次reduce 的结果再执行 reduce 操作，所以reduce 中的 photo_count 计数，不能依赖于 values.length, 而应该从传入的参数中获取。</p>
<h4 id="利用Underscore-js-框架调试MapReduce方法"><a href="#利用Underscore-js-框架调试MapReduce方法" class="headerlink" title="利用Underscore.js 框架调试MapReduce方法"></a>利用Underscore.js 框架调试MapReduce方法</h4><p>参见<a href="http://gregorowicz.blogspot.com/2010/12/debugging-mapreduce-in-mongodb.html" target="_blank" rel="noopener">Debugging MapReduce in MongoDB</a></p>
<p><strong>Tips</strong></p>
<ul>
<li>MongoDB 最分将不同的业务进行垂直切分，存储到不到的db中，这样分别在找出慢查询及定位问题的时候更清晰。</li>
<li>Pretty print in MongoDB shell:  <code>db.collection.find().pretty()</code></li>
</ul>
<h4 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h4><ul>
<li><a href="http://docs.mongodb.org/manual/applications/map-reduce/" target="_blank" rel="noopener">Map-Reduce</a></li>
<li><a href="http://docs.mongodb.org/manual/reference/method/db.collection.mapReduce/#db.collection.mapReduce" target="_blank" rel="noopener">db.collection.mapReduce()</a></li>
<li><a href="http://docs.mongodb.org/manual/tutorial/getting-started-with-the-mongo-shell/" target="_blank" rel="noopener">Getting Started with the mongo Shell</a></li>
<li><a href="http://www.oschina.net/question/105422_49646" target="_blank" rel="noopener">Mongodb Mapreduce讨论及分享（平均数和唯一数统计误区）</a></li>
</ul>

      
    </div>
    <footer class="article-footer2">
      <div id="footer-info" class="inner">
        <a href="http://www.618shoe.com/">莆田1:1精仿鞋微信号</a>
        <a href="http://www.618shoe.com/">莆田高仿鞋子的价格表</a>
        <a href="http://www.618shoe.com/">关于莆田仿鞋</a>
        <a href="http://www.618shoe.com/">莆田高仿鞋淘宝店店名</a>
        <a href="http://www.618shoe.com/">莆田精仿鞋官网</a>
         咨询QQ：<a title="点击这里给我发消息" href="http://wpa.qq.com/msgrd?v=3&amp;uin=2727291807&amp;site=www.cactussoft.cn&amp;menu=yes" target="_blank"><img src="http://wpa.qq.com/pa?p=2:2727291807:41"></a>
      </div>
        <div id="footer-info" class="inner">
          <a href="http://www.618shoe.com/">莆田高仿鞋批发</a>&nbsp;&nbsp;
          <a href="http://www.618shoe.com/">1：1高仿鞋批发</a>&nbsp;&nbsp;
          <a href="http://www.618shoe.com/">高仿鞋批发市场</a>&nbsp;&nbsp;
          <a href="http://www.618shoe.com/">高仿鞋网</a>&nbsp;&nbsp;
          <a href="http://www.618shoe.com/">广州高仿鞋批发</a>&nbsp;&nbsp;
          <a href="http://www.618shoe.com/">外贸尾单鞋批发</a>&nbsp;&nbsp;
          <a href="http://www.618shoe.com/">精仿鞋专线</a>&nbsp;&nbsp;
      </div>
      <div id="footer-info" class="inner">
             <a href="http://www.618shoe.com/">莆田高仿鞋批发</a>&nbsp;&nbsp;
             公司网站:&nbsp;&nbsp;<a href="http://www.618shoe.com//" target="_blank">http://www.618shoe.com/</a>&nbsp;&nbsp;
             <a href="http://www.618shoe.com/">高仿鞋批发市场</a>
             微信 <img src="/pics/qrcode.jpg" style="width:100px;height:100px;">
      </div>
    </footer>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/blog/2012/12/21/mongodb-map-reduce/" data-id="cja9reqtr001fif5ifww3cfuo" class="article-share-link">Partager</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-java-profile" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/blog/2012/12/21/java-profile/" class="article-date">
  <time datetime="2012-12-20T16:07:00.000Z" itemprop="datePublished">2012-12-21</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Java-JVM/">Java JVM</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/blog/2012/12/21/java-profile/">Java Profile</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>通常进行系统问题定位的时候，可以通过一些数据进行分析。数据包括：运行日志、异常堆栈、GC日志、线程的快照（threaddump/javacore文件）、堆转存快照(heapdump/hprof文件)等。</p>
<p>这里简单介绍一下Java性能诊断的常规工具。</p>
<p>1.jps (JVM Process Status Tool),显示指定系统内所有的Hotspot虚拟机进程。<br>    用法：jsp -v</p>
<pre><code>-m 输出虚拟进程启动时传递给主类main()函数的参数  
-l 输出主类全名，如果进行执行的是jar包，输出jar路径  
-v 输出虚拟机进程启动时JVM参数
</code></pre><p>2.jstat: 观察GC情况  </p>
<pre><code>jstat -gc pid 2000  
jstat -gcutil pid 2000

[jstat - Java Virtual Machine Statistics Monitoring Tool](http://docs.oracle.com/javase/1.5.0/docs/tooldocs/share/jstat.html)

或者使用top, ps aux 查看总的内存占用情况
</code></pre><p>3.jinfo 查看与调整虚拟机的各项参数</p>
<pre>
    jinfo -h  
    Usage:  
        jinfo [option] <pid>  
            (to connect to running process)  
        jinfo [option] <executable <core="">  
            (to connect to a core file)  
        jinfo [option] [server_id@]<remote server="" ip="" or="" hostname="">  
            (to connect to remote debug server) 

    where <option> is one of:  
        -flag <name>         to print the value of the named VM flag  
        -flag [+|-]<name>    to enable or disable the named VM flag  
        -flag <name>=<value> to set the named VM flag to the given value  
        -flags               to print VM flags  
        -sysprops            to print Java system properties  
        <no option="">          to print both of the above  
        -h | -help           to print this help message
</no></value></name></name></name></option></remote></executable></pid></pre>


<p>4.jmap ,查看 heap 情况，如查看存活对象列表</p>
<pre><code>jmap -histo:live pid|grep com.company|less

或者dump 内存来分析

jmap -dump:file=test.bin pid

jmap 查看Java堆的详细信息

jmap -heap pid    
</code></pre><p>5.分析dump 堆文件，可以用jhat:</p>
<pre><code>jhat test.bin

分析完成后可以用浏览器查看堆的情况。
还可以用 Eclipse Memory Analyzer (MAT)工作进行分析，或者IBM的Heap Analyzer.
</code></pre><p>6.jstack : Java堆栈跟踪工具</p>
<pre><code>jstack pid &gt; thread_dump 

jstack -l 除了堆栈以外显示关于锁的附加信息
</code></pre><p>7.jvisualvm 和 jconsole, JVM 自带的图形化工具</p>
<p>8.Btrace </p>
<p>####参考资料</p>
<ul>
<li>《深入理解Java虚拟机》- 周志明著 第4章</li>
<li><a href="http://www.blogjava.net/killme2008/archive/2012/04/17/374936.html" target="_blank" rel="noopener">Java程序员常用工具集 - 庄周梦蝶</a></li>
<li><a href="http://kenwublog.com/docs/java6-jvm-options-chinese-edition.htm" target="_blank" rel="noopener">Java 6 JVM参数选项大全（中文版）</a></li>
<li><a href="http://docs.oracle.com/javase/7/docs/technotes/tools/index.html" target="_blank" rel="noopener">JDK Tools and Utilities</a></li>
<li><a href="http://docs.oracle.com/javase/7/docs/webnotes/tsg/TSG-VM/html/clopts.html" target="_blank" rel="noopener">Command-Line Options - Troubleshooting Guide for HotSpot VM</a></li>
<li><a href="http://docs.oracle.com/javase/7/docs/webnotes/tsg/index.html" target="_blank" rel="noopener">JDK Troubleshooting Guide</a></li>
<li><a href="http://www.oracle.com/technetwork/java/javase/tech/vmoptions-jsp-140102.html" target="_blank" rel="noopener">Java HotSpot VM Options</a></li>
</ul>

      
    </div>
    <footer class="article-footer2">
      <div id="footer-info" class="inner">
        <a href="http://www.618shoe.com/">莆田1:1精仿鞋微信号</a>
        <a href="http://www.618shoe.com/">莆田高仿鞋子的价格表</a>
        <a href="http://www.618shoe.com/">关于莆田仿鞋</a>
        <a href="http://www.618shoe.com/">莆田高仿鞋淘宝店店名</a>
        <a href="http://www.618shoe.com/">莆田精仿鞋官网</a>
         咨询QQ：<a title="点击这里给我发消息" href="http://wpa.qq.com/msgrd?v=3&amp;uin=2727291807&amp;site=www.cactussoft.cn&amp;menu=yes" target="_blank"><img src="http://wpa.qq.com/pa?p=2:2727291807:41"></a>
      </div>
        <div id="footer-info" class="inner">
          <a href="http://www.618shoe.com/">莆田高仿鞋批发</a>&nbsp;&nbsp;
          <a href="http://www.618shoe.com/">1：1高仿鞋批发</a>&nbsp;&nbsp;
          <a href="http://www.618shoe.com/">高仿鞋批发市场</a>&nbsp;&nbsp;
          <a href="http://www.618shoe.com/">高仿鞋网</a>&nbsp;&nbsp;
          <a href="http://www.618shoe.com/">广州高仿鞋批发</a>&nbsp;&nbsp;
          <a href="http://www.618shoe.com/">外贸尾单鞋批发</a>&nbsp;&nbsp;
          <a href="http://www.618shoe.com/">精仿鞋专线</a>&nbsp;&nbsp;
      </div>
      <div id="footer-info" class="inner">
             <a href="http://www.618shoe.com/">莆田高仿鞋批发</a>&nbsp;&nbsp;
             公司网站:&nbsp;&nbsp;<a href="http://www.618shoe.com//" target="_blank">http://www.618shoe.com/</a>&nbsp;&nbsp;
             <a href="http://www.618shoe.com/">高仿鞋批发市场</a>
             微信 <img src="/pics/qrcode.jpg" style="width:100px;height:100px;">
      </div>
    </footer>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/blog/2012/12/21/java-profile/" data-id="cja9reqtn001aif5i6rg8secj" class="article-share-link">Partager</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-unicode-in-python" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/blog/2012/12/19/unicode-in-python/" class="article-date">
  <time datetime="2012-12-19T03:30:00.000Z" itemprop="datePublished">2012-12-19</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Unicode-Python/">Unicode Python</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/blog/2012/12/19/unicode-in-python/">unicode in python</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>在python里，你可能会经常看到如下错误：</p>
<blockquote>
<p>UnicodeDecodeError: ‘ascii’ codec can’t decode byte 0xd6 in position 0: ordinal not in range(128)</p>
</blockquote>
<h4 id="一、默认编码-defaultencoding"><a href="#一、默认编码-defaultencoding" class="headerlink" title="一、默认编码 defaultencoding"></a>一、默认编码 defaultencoding</h4><p>python 在不同的平台上所采用的默认编码是不一样的。可以通过 sys.getdefaultencoding() 来获取。</p>
<pre><code>import sys
print sys.getdefaultencoding()
</code></pre><p>windows 平台上的默认编码为utf8,linux平台上的默认编码是ascii。</p>
<p><strong>设置默认编码</strong></p>
<pre><code>import sys
reload(sys)
sys.setdefaultencoding(&quot;utf-8&quot;)
</code></pre><h4 id="二、字符串string-与-unicode"><a href="#二、字符串string-与-unicode" class="headerlink" title="二、字符串string 与 unicode"></a>二、字符串string 与 unicode</h4><p>#####1. utf-8 的字符串</p>
<p><pre></pre></p>
<pre><code>&gt;&gt;&gt;&quot;中文&quot;
&apos;\xe4\xb8\xad\xe6\x96\x87&apos;

&gt;&gt;&gt; type(&quot;中文&quot;)
&amp;lt;type &apos;str&apos;&amp;gt;

&gt;&gt;&gt; len(&quot;中文&quot;)
6
</code></pre><p><br>中文的utf8编码，每个汉字占用3个byte,两个汉字的长度为6.<br>python 中的str 字符串只是某种编码的 bytes 字节序列，而非真正意义上的字符序列。</p>
<p>#####2. unicode</p>
<p><pre></pre></p>
<pre><code>&gt;&gt;&gt; u&quot;中文&quot;
u&apos;\u4e2d\u6587&apos;

&gt;&gt;&gt; type(u&quot;中文&quot;)
&amp;lt;type &apos;unicode&apos;&amp;gt;

&gt;&gt;&gt; len(u&quot;中文&quot;)
2
</code></pre><p><br>中文的unicode编码，由两个汉字的unicode point 组成，长度为2.</p>
<p>####三、编码转换</p>
<p>#####1. unicode 转换成目标编码</p>
<pre><code>uni_str = u&quot;中文&quot;
utf8_str = uni_str.encode(&quot;utf-8&quot;)
gbk_str = uni_str.encode(&quot;gbk&quot;)
gb2312_str = uni_str.encode(&quot;gb2312&quot;)
utf16_str = uni_str.encode(&quot;utf-16&quot;)
</code></pre><p>中文不能转换成 ascii,所以采用英文。</p>
<pre><code>uni_str = u&quot;chinese&quot;
asc_str = uni_str.encode(&quot;ascii&quot;)
</code></pre><p>#####2. 其它编码转换成 unicode</p>
<pre><code>us1 = unicode(utf8_str,&quot;utf-8&quot;)    
us2 = unicode(gbk_str,&quot;gbk&quot;)    
us3 = unicode(gb2312_str,&quot;gb2312&quot;)    
us4 = unicode(utf16_str,&quot;utf-16&quot;)    
us5 = unicode(asc_str,&quot;ascii&quot;)    
</code></pre><p>也可以采用 string.decode的方式，转换成utf8</p>
<pre><code>us1 = &quot;中文&quot;.decode(&quot;utf-8&quot;)
us2 = gbk_str.decode(&quot;gbk&quot;)
</code></pre><p>#####3.判断字符串的编码</p>
<ul>
<li>isinstance(s, str) 用来判断是否为一般字符串 </li>
<li>isinstance(s, unicode) 用来判断是否为unicode </li>
</ul>
<h4 id="四、python-文件的编码"><a href="#四、python-文件的编码" class="headerlink" title="四、python 文件的编码"></a>四、python 文件的编码</h4><p>代码文件 # -<em>- coding=utf-8 -</em>-或者 #coding=utf-8 </p>
<p>◆ sys.setdefaultencoding(“utf-8”) 不一定适应于所有的python 版本？<br><strong>解决方案</strong>  </p>
<ol>
<li>Decode earyly  </li>
<li>Unicode everywhere  </li>
<li>Encode late</li>
</ol>
<p>#####1. 读写文件</p>
<pre><code># coding: UTF-8

f = open(&apos;test.txt&apos;)
s = f.read()
f.close()
print type(s) # &lt;type &apos;str&apos;&gt;
# 已知是UTF-8编码，解码成unicode
u = s.decode(&apos;UTF-8&apos;)
</code></pre><p>内置的open()方法打开文件时，read()读取的是str，读取后需要使用正确的编码格式进行decode()。</p>
<pre><code>f = open(&apos;test.txt&apos;, &apos;w&apos;)
# 编码成UTF-8编码的str
s = u.encode(&apos;UTF-8&apos;)
f.write(s)
f.close()
</code></pre><p>write()写入时，如果参数是unicode，则需要使用你希望写入的编码进行encode()，如果是其他编码格式的str，则需要先用该str的编码进行decode()，转成unicode后再使用写入的编码进行encode()。</p>
<p>#####2. 根据字符串是否unicode编码，来进行解码</p>
<pre><code>def to_unicode_or_bust(obj, encoding=&apos;utf-8&apos;):
     if isinstance(obj, basestring):
         if not isinstance(obj, unicode):
             obj = unicode(obj, encoding)
     return obj
</code></pre><p>#####3. 使用codecs 进行文件读写操作</p>
<pre><code>import codecs

f = codecs.open(&apos;test.txt&apos;, encoding=&apos;UTF-8&apos;)
u = f.read()
f.close()
print type(u) # &lt;type &apos;unicode&apos;&gt;

f = codecs.open(&apos;test.txt&apos;, &apos;a&apos;, encoding=&apos;UTF-8&apos;)
# 写入unicode
f.write(u)

# 写入str，自动进行解码编码操作
# GBK编码的str
s = &apos;汉&apos;
print repr(s) # &apos;\xba\xba&apos;
# 这里会先将GBK编码的str解码为unicode再编码为UTF-8写入
f.write(s) 
f.close()
</code></pre><p>#####4. BOM文件头</p>
<p>decoding UTF-16 会自动移除BOM，但是UTF-8不会，需要进行 s.decode(‘utf-8-sig’)<br>也可以使用chardet.detect() 来检查文件编码。</p>
<h4 id="五、Python3"><a href="#五、Python3" class="headerlink" title="五、Python3"></a>五、Python3</h4><ul>
<li>在python3 中 &lt;type ‘str’&gt; 是一个unicode 对象。</li>
<li>separate &lt;type ‘bytes’&gt; type</li>
<li>所有内建模块支持unicode</li>
<li>不再需要 u’text’ 的写法</li>
<li>open() 方法可以像 codecs.open() 一样接受 encoding 编码参数</li>
<li>默认编码是UTF-8.</li>
</ul>
<h4 id="六、API参考"><a href="#六、API参考" class="headerlink" title="六、API参考"></a>六、API参考</h4><p><strong>str(object=’’)</strong><br>返回以良好格式表示一个对象，对于字符串对象将返回字符串本身。str() 的可读性更好，无法用于eval求值；而 repr(object) 则返回一个可以被 eval() 接受的字符串格式。</p>
<p>unicode(object=’’)<br>unicode(object[, encoding[, errors]])  </p>
<p><strong>str.decode([encoding[, errors]])</strong></p>
<p><strong>str.encode([encoding[, errors]])</strong></p>
<p><strong>basestring()  </strong><br>是 <strong>str</strong> 和 <strong>unicode</strong> 的superclass,不能被直接调用或实例化，但可以用来判断一个对象object 是否 str或 unicode 的实例。<br>isinstance(obj,basestring) 等同于 isinstance(obj,(str,unicode))</p>
<p><strong>isinstance(object, classinfo)</strong><br>Return true if the object argument is an instance of the classinfo argument, </p>
<p><strong>bytearray([source[, encoding[, errors]]])</strong><br>bytearray 会返回一个字节数组。bytearray 类型是一个含有 0&lt;= x &lt; 256 数字的可变序列。<br>source 参数：  </p>
<ul>
<li>如果是字符串，bytearray() 相当于 str.encode()</li>
<li>如果是整数，会被初始化为长度为整数值，bytes为null的数组</li>
<li>如果是个对象并且实现了buffer 接口，一个只读的该对象buffer会被用来初始化该数组</li>
<li>如果是 iterable（可迭代的对象），必须是 0&lt;=x&lt; 256 整数的迭代，用来初始化数组</li>
<li>如果没有参数，会创建一个长度为0的数组</li>
</ul>
<p><strong>chr(i)</strong><br>返回一个包含一个该整数所对应的ascii字符的字符串，例如  chr(97) 返回字符串’a’。这个方法是 ord的逆过程，参数必须在[0..255]内，超过这个范围的会产生异常。</p>
<p><strong>unichr(i)</strong><br>返回该整数值对应的unicode 字符串。</p>
<p><strong>type(object)</strong><br>返回该object 的类型。也可用isinstance() 测试是否为指定类型的对象.</p>
<p><strong>type(name, bases, dict)</strong><br>返回一个新的类型对象.<br>name 对应于 __name<strong> 属性； base 对应于 \</strong>base<strong> 属性； dict 对应于 \</strong>dict__ 属性。<br>示例：  X = type(‘X’, (object,), dict(a=1))</p>
<p>####七、编码标准</p>
<p>ISO 8859-1<br>　　ISO/IEC 8859-1，又称Latin-1或“西欧语言”，是国际标准化组织内ISO/IEC 8859的第一个8位字符集。</p>
<p>####八、tornado 中的编码处理</p>
<p>tornado 对于http header 的编码：</p>
<blockquote>
<p>HTTP headers are generally ascii (officially they’re latin1, but use of non-ascii is rare), so we mostly represent them (and data derived from them) with native strings (note that in python2 if a header contains non-ascii data tornado will decode the latin1 and re-encode as utf8!)</p>
</blockquote>
<p>也就是说tornado 会把header 中非utf-8的字符全部解码成latin1 (即ISO-8859-1)，再进行utf-8编码。</p>
<p>为了取到正确包含中文的header值(utf-8编码)，需要先进行utf-8解码，再编码成latin1,最后以utf-8 进行解码。如下：</p>
<pre><code>value = header_value.decode(&apos;utf-8&apos;).encode(&apos;latin-1&apos;).decode(&apos;utf-8&apos;)
</code></pre><p>参考资料</p>
<ul>
<li><a href="http://farmdev.com/talks/unicode/" target="_blank" rel="noopener">Unicode In Python, Completely Demystified</a></li>
<li><a href="http://www.cnblogs.com/huxi/archive/2010/12/05/1897271.html" target="_blank" rel="noopener">Python字符编码详解</a></li>
<li><a href="http://hi.baidu.com/ekpumiyvnciouye/item/d6e4773a238e24bd633afffc" target="_blank" rel="noopener">python 编码问题总结</a></li>
<li><a href="http://blog.csdn.net/yatere/article/details/6606316" target="_blank" rel="noopener">python str与bytes之间的转换</a></li>
<li><a href="http://code.activestate.com/recipes/466341-guaranteed-conversion-to-unicode-or-byte-string/" target="_blank" rel="noopener">Guaranteed conversion to unicode or byte string</a></li>
<li><a href="http://docs.python.org/2/library/functions.html" target="_blank" rel="noopener">Built-in Functions</a> - python docs</li>
<li><a href="http://docs.python.org/2/library/codecs.html#standard-encodings" target="_blank" rel="noopener">Standard Encodings</a> - python standard-encodings</li>
<li><a href="https://github.com/facebook/tornado/wiki/Strings-and-Unicode" target="_blank" rel="noopener">Strings and Unicode</a> - tornado中编码的处理</li>
<li><a href="http://zh.wikipedia.org/wiki/Unicode" target="_blank" rel="noopener">Unicode</a> - Wiki</li>
<li><a href="http://zh.wikipedia.org/wiki/UTF-8" target="_blank" rel="noopener">UTF-8</a>- Wiki</li>
<li><a href="http://zh.wikipedia.org/wiki/ISO/IEC_8859-1" target="_blank" rel="noopener">ISO/IEC 8859-1</a> - Wiki</li>
</ul>

      
    </div>
    <footer class="article-footer2">
      <div id="footer-info" class="inner">
        <a href="http://www.618shoe.com/">莆田1:1精仿鞋微信号</a>
        <a href="http://www.618shoe.com/">莆田高仿鞋子的价格表</a>
        <a href="http://www.618shoe.com/">关于莆田仿鞋</a>
        <a href="http://www.618shoe.com/">莆田高仿鞋淘宝店店名</a>
        <a href="http://www.618shoe.com/">莆田精仿鞋官网</a>
         咨询QQ：<a title="点击这里给我发消息" href="http://wpa.qq.com/msgrd?v=3&amp;uin=2727291807&amp;site=www.cactussoft.cn&amp;menu=yes" target="_blank"><img src="http://wpa.qq.com/pa?p=2:2727291807:41"></a>
      </div>
        <div id="footer-info" class="inner">
          <a href="http://www.618shoe.com/">莆田高仿鞋批发</a>&nbsp;&nbsp;
          <a href="http://www.618shoe.com/">1：1高仿鞋批发</a>&nbsp;&nbsp;
          <a href="http://www.618shoe.com/">高仿鞋批发市场</a>&nbsp;&nbsp;
          <a href="http://www.618shoe.com/">高仿鞋网</a>&nbsp;&nbsp;
          <a href="http://www.618shoe.com/">广州高仿鞋批发</a>&nbsp;&nbsp;
          <a href="http://www.618shoe.com/">外贸尾单鞋批发</a>&nbsp;&nbsp;
          <a href="http://www.618shoe.com/">精仿鞋专线</a>&nbsp;&nbsp;
      </div>
      <div id="footer-info" class="inner">
             <a href="http://www.618shoe.com/">莆田高仿鞋批发</a>&nbsp;&nbsp;
             公司网站:&nbsp;&nbsp;<a href="http://www.618shoe.com//" target="_blank">http://www.618shoe.com/</a>&nbsp;&nbsp;
             <a href="http://www.618shoe.com/">高仿鞋批发市场</a>
             微信 <img src="/pics/qrcode.jpg" style="width:100px;height:100px;">
      </div>
    </footer>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/blog/2012/12/19/unicode-in-python/" data-id="cja9reqtp001cif5isls5gc38" class="article-share-link">Partager</a>
      
      
    </footer>
  </div>
  
</article>


  


  <nav id="page-nav">
    <a class="extend prev" rel="prev" href="/page/2/">&laquo; __('prev')</a><a class="page-number" href="/">1</a><a class="page-number" href="/page/2/">2</a><span class="page-number current">3</span><a class="page-number" href="/page/4/">4</a><a class="page-number" href="/page/5/">5</a><a class="extend next" rel="next" href="/page/4/">__('next') &raquo;</a>
  </nav>
</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Catégories</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Algorithm/">Algorithm</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Architecture/">Architecture</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/DevTools/">DevTools</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/DevTools-Eclipse/">DevTools Eclipse</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Java/">Java</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Java-Btrace/">Java Btrace</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Java-JVM/">Java JVM</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Java-MultiThreading/">Java MultiThreading</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Java-NIO/">Java NIO</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Java-Reflection/">Java Reflection</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Java-Unicode/">Java Unicode</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Linux-Shell/">Linux Shell</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/MongoDB/">MongoDB</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/NSQ-golang/">NSQ golang</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Python/">Python</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Solr/">Solr</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Solr-Lucene/">Solr Lucene</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Unicode-Python/">Unicode Python</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/git-DevTools/">git DevTools</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/jafka-zookeeper/">jafka zookeeper</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/jsonp-security/">jsonp security</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/thrift/">thrift</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/zookeeper/">zookeeper</a></li></ul>
    </div>
  </div>


  
    

  
    
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/11/">November 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/01/">January 2015</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/02/">February 2014</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/08/">August 2013</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/07/">July 2013</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/03/">March 2013</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2012/12/">December 2012</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Articles récents</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/blog/2017/11/21/hello-world/">Hello World</a>
          </li>
        
          <li>
            <a href="/blog/2015/01/16/process-task-by-queue/">process task by queue</a>
          </li>
        
          <li>
            <a href="/blog/2015/01/15/threadpoolexecutor/">ThreadPoolExecutor 学习笔记</a>
          </li>
        
          <li>
            <a href="/blog/2014/02/19/nsq-internals/">nsq internals</a>
          </li>
        
          <li>
            <a href="/blog/2014/02/18/nsq-design/">nsq design</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
 	<div id="footer-info" class="inner">
     咨询QQ：<a title="点击这里给我发消息" href="http://wpa.qq.com/msgrd?v=3&amp;uin=2727291807&amp;site=www.cactussoft.cn&amp;menu=yes" target="_blank"><img src="http://wpa.qq.com/pa?p=2:2727291807:41"></a>
 	</div>
   	<div id="footer-info" class="inner">
     	<a href="http://www.618shoe.com/">莆田高仿鞋批发</a>&nbsp;&nbsp;
     	<a href="http://www.618shoe.com/">1：1高仿鞋批发</a>&nbsp;&nbsp;
     	<a href="http://www.618shoe.com/">高仿鞋批发市场</a>&nbsp;&nbsp;
     	<a href="http://www.618shoe.com/">高仿鞋网</a>&nbsp;&nbsp;
     	<a href="http://www.618shoe.com/">广州高仿鞋批发</a>&nbsp;&nbsp;
    	<a href="http://www.618shoe.com/">外贸尾单鞋批发</a>&nbsp;&nbsp;
    	<a href="http://www.618shoe.com/">精仿鞋专线</a>&nbsp;&nbsp;
	</div>
 	<div id="footer-info" class="inner">
         <a href="http://www.618shoe.com/">莆田高仿鞋批发微信号</a>&nbsp;&nbsp;
         公司网站:&nbsp;&nbsp;<a href="http://www.618shoe.com//" target="_blank">http://www.618shoe.com/</a>&nbsp;&nbsp;
         <a href="http://www.618shoe.com/">高仿鞋批发市场</a>
         微信 <img src="/pics/qrcode.jpg" style="width:100px;height:100px;">
 	</div>
    <div id="footer-info" class="inner">
      &copy; 2017 Sharewind<br>
      Propulsé by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>

  </div>
</body>
</html>
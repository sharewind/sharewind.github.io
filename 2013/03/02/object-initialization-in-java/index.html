<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="keywords" content=" 耐克赤足系列 耐克赤足2.0 3.0 4.0 5.0 7.0 耐克赤足跑鞋 耐克赤足二代 耐克编织跑鞋 耐克飞线系列 耐克飞线彩虹 耐克飞线气垫      耐克飞线价格 耐克飞线2014 耐克飞线鞋 耐克飞线登月 耐克飞线科技 耐克飞线2015 耐克登月系列 耐克登月3 4 5 6耐克登月系列跑步鞋 耐克阿甘鞋 耐克2013气垫鞋        耐克2014全掌气垫鞋 耐克2015气垫鞋 耐克max90高板反毛皮跑鞋" />
  <meta name="description" content="莆田批发高仿真标耐克系列跑鞋 耐克赤足滴塑新科技超轻NIKE FREE 5.0 耐克Nike Roshe Flyknit新款跑鞋 耐克2013磨砂皮            耐克赤足Nike Free 4.0 Flyknit赤足跑鞋 耐克登月6跑鞋 耐克2013男鞋 Nike Solarsoft Moccasin Woven 编织纹 超轻跑步鞋太阳神反毛皮 耐克2014飞线 耐克2015飞线      耐克登月NIKE FLYKNIT LUNAR2+编织版  耐克2013 耐克20K6代 7代 耐克87代系列轻量跑鞋" />
  
  <title>Java中的对象初始化 | sharewind coder blog</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="1. 一般类的初始化顺序 加载类 设置所有的静态成员为默认值(0,false,0.0 etc.)，引用类型初始化null 按照在类声明中出现的次序，依次执行静态成员或静态块的初始化。静态初始化只在Class对象首次加载的时候进行一次。 new Class() 创建一个实例对象时,首先在堆上为实例对象分配足够的存储空间。">
<meta property="og:type" content="article">
<meta property="og:title" content="Java中的对象初始化">
<meta property="og:url" content="http://yoursite.com/2013/03/02/object-initialization-in-java/index.html">
<meta property="og:site_name" content="sharewind coder blog">
<meta property="og:description" content="1. 一般类的初始化顺序 加载类 设置所有的静态成员为默认值(0,false,0.0 etc.)，引用类型初始化null 按照在类声明中出现的次序，依次执行静态成员或静态块的初始化。静态初始化只在Class对象首次加载的时候进行一次。 new Class() 创建一个实例对象时,首先在堆上为实例对象分配足够的存储空间。 这块存储空间会清零，自动将实例对象的所有基本类型数据都设置成默认值，而引用类型">
<meta property="og:updated_time" content="2014-03-20T03:06:15.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Java中的对象初始化">
<meta name="twitter:description" content="1. 一般类的初始化顺序 加载类 设置所有的静态成员为默认值(0,false,0.0 etc.)，引用类型初始化null 按照在类声明中出现的次序，依次执行静态成员或静态块的初始化。静态初始化只在Class对象首次加载的时候进行一次。 new Class() 创建一个实例对象时,首先在堆上为实例对象分配足够的存储空间。 这块存储空间会清零，自动将实例对象的所有基本类型数据都设置成默认值，而引用类型">
  
    <link rel="alternate" href="/atom.xml" title="sharewind coder blog" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link rel="stylesheet" href="/css/style.css">
  

</head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">sharewind coder blog</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://yoursite.com"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main"><article id="post-object-initialization-in-java" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2013/03/02/object-initialization-in-java/" class="article-date">
  <time datetime="2013-03-02T02:24:00.000Z" itemprop="datePublished">2013-03-02</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Java/">Java</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      Java中的对象初始化
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h5 id="1-一般类的初始化顺序"><a href="#1-一般类的初始化顺序" class="headerlink" title="1. 一般类的初始化顺序"></a>1. 一般类的初始化顺序</h5><ul>
<li>加载类</li>
<li>设置所有的静态成员为默认值(0,false,0.0 etc.)，引用类型初始化null</li>
<li>按照在类声明中出现的次序，依次执行静态成员或静态块的初始化。静态初始化只在Class对象首次加载的时候进行一次。</li>
<li>new Class() 创建一个实例对象时,首先在堆上为<strong>实例对象</strong>分配足够的存储空间。</li>
<li>这块存储空间会清零，自动将<strong>实例对象</strong>的所有基本类型数据都设置成默认值，而引用类型被设置为null.</li>
<li>初始化类的实例成员，实例成员间的初始化顺序取决于在类的中声明顺序。</li>
<li>执行构造方法</li>
</ul>
<h5 id="2-继承结构的初始化顺序"><a href="#2-继承结构的初始化顺序" class="headerlink" title="2. 继承结构的初始化顺序"></a>2. 继承结构的初始化顺序</h5><ul>
<li>先执行父类的静态成员初始化</li>
<li>执行子类的静态成员初始化</li>
<li>执行父类的实例成员初始化</li>
<li>再执行父类的构造函数</li>
<li>执行子类的实例成员初始化</li>
<li>执行子类的构造函数</li>
</ul>
<p>code:</p>
<pre><code>class Who{

    public Who(String name){
        System.out.println(name + &quot; is here!&quot;);
    }

}



class Child extends Parent{

    Who w3 = new Who(&quot;Child instance&quot;);

    static{
        System.out.println(&quot;Child static block 1&quot;);
    }

    static Who w4 = new Who(&quot;Child static&quot;);

    static{
        System.out.println(&quot;Child static block 2&quot;);
    }

    public Child(){
        System.out.println(&quot;Child construct&quot;);
    }

}


class Parent{

    Who w2 = new Who(&quot;Parent instance&quot;);

    static{
        System.out.println(&quot;Parent static block 1&quot;);
    }

    static Who w1 = new Who(&quot;Parent static&quot;);

    static{
        System.out.println(&quot;Parent static block 2&quot;);
    }

    public Parent(){
        System.out.println(&quot;Parent construct&quot;);
    }

}

public class Test {
    public static void main(String[] args) {
        new Child();
    }
}
</code></pre><p><strong>输出：</strong></p>
<pre><code>Parent static block 1
Parent static is here!
Parent static block 2
Child static block 1
Child static is here!
Child static block 2
Parent instance is here!
Parent construct
Child instance is here!
Child construct
</code></pre><h5 id="3-类的静态块中，启动一个线程（线程中包含类的静态变量）"><a href="#3-类的静态块中，启动一个线程（线程中包含类的静态变量）" class="headerlink" title="3. 类的静态块中，启动一个线程（线程中包含类的静态变量）"></a>3. 类的静态块中，启动一个线程（线程中包含类的静态变量）</h5><pre><code>class Foo {

    public Foo(int i) {
        System.out.println(&quot;foo&quot; + i + &quot; construct &quot;);
    }
}

class Example {

    static {
        System.out.println(&quot;static block 1 &quot;);
        // compile error
        // System.out.println(&quot;Print &quot; + foo);

        new Thread(new Runnable() {

            @Override
            public void run() {
                System.out.println(&quot;Thread1 &quot;);
                // System.out.println(&quot;Thread run whith foo2 &quot; + foo2);
            }
        }).start();
    }


    static {
        System.out.println(&quot;static block 2 &quot;);

        new Thread(new Runnable() {

            @Override
            public void run() {
                System.out.println(&quot;Thread2 run whith foo &quot; + foo);
                // System.out.println(&quot;Thread run whith foo2 &quot; + foo2);
            }
        }).start();

        try {
            System.out.println(&quot;main thread sleep &quot;);
            Thread.sleep(1000 * 5);
        } catch (InterruptedException e) {
            e.printStackTrace();
        }
    }

    static Foo foo = new Foo(1);

    final Foo foo2 = new Foo(2);

    static {
        System.out.println(&quot;static block 3 &quot;);
    }

    public Example() {
        System.out.println(&quot;Example construct&quot;);
    }

}

public class Test2 {

    public static void main(String[] args) {
        new Example();
    }
}
</code></pre><p><strong>输出：</strong></p>
<pre><code>static block 1 
static block 2 
main thread sleep 
Thread1 
foo1 construct 
static block 3 
foo2 construct 
Example construct
Thread2 run whith foo Foo@10c042ab
</code></pre><p><strong>结论：</strong>  </p>
<ol>
<li>可见如果静态块中创建的线程，如果引用类的静态成员，会等到类的静态成员初始化完成后再执行该线程。</li>
</ol>
<p>#####5. stackoverflow 上的奇葩问题</p>
<pre><code>import java.util.ArrayList;
import java.util.List;

public class Test3 {
    public static void main(String[] args) {
        SomeClass.getInstance();
    }
}

class SomeClass {

    private static final SomeClass instance = new SomeClass();

    public static SomeClass getInstance() {
        return instance;
    }

    static {
        System.out.println(&quot;Someclass static init&quot;);
    }
    private static String objectName1 = &quot;test1&quot;;
    private static String objectName2 = &quot;test2&quot;;

    @SuppressWarnings(&quot;serial&quot;)
    private List&lt;SomeObject&gt; list = new ArrayList&lt;SomeObject&gt;() {
        {
            add(new SomeObject(objectName1));
            add(new SomeObject(objectName2));
        }
    };

    public SomeClass(){
        System.out.println(&quot;some class construct&quot;);
        System.out.println(&quot;list is &quot; + list);
    }
}

class SomeObject {

    String name;

    SomeObject(String name) {
        this.name = name;
        System.out.println(&quot;my name is:&quot; + name);
    }
}
</code></pre><p><strong>输出：</strong></p>
<pre><code>my name is:null
my name is:null
some class construct
list is [SomeObject@780adb3f, SomeObject@10c042ab]
Someclass static init
</code></pre><p><strong>牛人解答：</strong></p>
<blockquote>
<p>Static blocks are initialized in order (so you can rely on the ones above in the ones below). By creating an instance of SomeClass as your first static initializer in SomeClass, you’re forcing an instance init during the static init phase.</p>
<p>So the logical order of execution of your code is:</p>
<ul>
<li>Load class SomeClass, all static fields initially defaults (0, null, etc.)</li>
<li>Begin static inits</li>
<li>First static init creates instance of SomeClass</li>
<li>Begin instance inits for SomeClass instance, using current values for static fields (so objectName1 and objectName2 are null)</li>
<li>Load SomeObject class, all static fields initially default (you don’t have any)</li>
<li>Do SomeObject static inits (you don’t have any)</li>
<li>Create instances of SomeObject using the passed-in null values</li>
<li>Continue static inits of SomeClass, setting objectName1 and objectName2</li>
</ul>
<p>To make this work as you may expect, simply put the inits for objectName1 and objectName2 above the init for instance.</p>
</blockquote>
<hr>
<p>As suggested moving this line:</p>
<pre><code>private static final SomeClass  instance    = new SomeClass();
</code></pre><p>after these:</p>
<pre><code>private  static String objectName1  =&quot;test1&quot;;
private  static String objectName2  =&quot;test2&quot;;
</code></pre><p>should fix the problem.</p>
<p>#####6. 多线程初始化</p>
<p><strong>类的初始化</strong>阶段是执行类构造器<code>&lt;clinit&gt;()</code>方法的过程。  </p>
<ul>
<li>&lt;clinit&gt;()方法是由编译器自动收集类中的所有类变量的赋值动作和静态语句块（static{}块）中的语句合并产生的，编译器收集的顺序是由语句在源文件中出现的顺序决定。</li>
<li>虚拟机会保证在子类的&lt;clinit&gt;()方法执行之前，父类的&lt;clinit&gt;()已经执行完毕。</li>
<li>由于父类的&lt;clinit&gt;()方法先执行，也就意味着父类中定义的静态语句块要优先于子类的变量赋值操作。</li>
<li>如果一个类没有静态语句块，也没有对变更的赋值操作，那么编译器可以不为这个类生成&lt;clinit&gt;()。</li>
<li>接口中不能使用静态语句块，但仍然有变量初始化的赋值操作，因此接口与类一样会生成&lt;clinit&gt;()方法。</li>
<li>虚拟机会操作一个类的&lt;clinit&gt;()方法在多线程环境中被正确的回销和同步。多个线程同时初始化一个对象，那么只会有一个线程去执行这个类的&lt;clinit&gt;()方法。</li>
</ul>
<p>示例：</p>
<pre><code>public class DeadLoopDemo{

    static{

        if(true){
            System.out.println(Thread.currentThread() + &quot;init DeadLoopDemo&quot;);
            while (true) {

            }
        }
    }

    public static void main(String[] args) {

        Runnable runable = new Runnable() {

            @Override
            public void run() {
                // TODO Auto-generated method stub
                System.out.println(Thread.currentThread() + &quot;start&quot;);
                DeadLoopDemo d1 = new DeadLoopDemo();
                System.out.println(Thread.currentThread() + &quot;stop&quot;);

            }
        };

        Thread t1 = new Thread(runable);
        Thread t2 = new Thread(runable);
        t1.start();
        t2.start();
    }
}
</code></pre><p>####参考资料  </p>
<ul>
<li><a href="http://www.artima.com/designtechniques/initializationP.html" target="_blank" rel="noopener">Object Initialization in Java</a></li>
<li><a href="http://stackoverflow.com/questions/7687030/java-constructor-order" target="_blank" rel="noopener">java-constructor-order</a>  - Stack Overflow</li>
<li>Thinking in Java</li>
<li>《深入理解Java虚拟机》——周志明著</li>
</ul>

      
    </div>
    <footer class="article-footer2">
      <div id="footer-info" class="inner">
        <a href="http://www.618shoe.com/">莆田1:1精仿鞋微信号</a>
        <a href="http://www.618shoe.com/">莆田高仿鞋子的价格表</a>
        <a href="http://www.618shoe.com/">关于莆田仿鞋</a>
        <a href="http://www.618shoe.com/">莆田高仿鞋淘宝店店名</a>
        <a href="http://www.618shoe.com/">莆田精仿鞋官网</a>
         咨询QQ：<a title="点击这里给我发消息" href="http://wpa.qq.com/msgrd?v=3&amp;uin=2727291807&amp;site=www.cactussoft.cn&amp;menu=yes" target="_blank"><img src="http://wpa.qq.com/pa?p=2:2727291807:41"></a>
      </div>
        <div id="footer-info" class="inner">
          <a href="http://www.618shoe.com/">莆田高仿鞋批发</a>&nbsp;&nbsp;
          <a href="http://www.618shoe.com/">1：1高仿鞋批发</a>&nbsp;&nbsp;
          <a href="http://www.618shoe.com/">高仿鞋批发市场</a>&nbsp;&nbsp;
          <a href="http://www.618shoe.com/">高仿鞋网</a>&nbsp;&nbsp;
          <a href="http://www.618shoe.com/">广州高仿鞋批发</a>&nbsp;&nbsp;
          <a href="http://www.618shoe.com/">外贸尾单鞋批发</a>&nbsp;&nbsp;
          <a href="http://www.618shoe.com/">精仿鞋专线</a>&nbsp;&nbsp;
      </div>
      <div id="footer-info" class="inner">
             <a href="http://www.618shoe.com/">莆田高仿鞋批发</a>&nbsp;&nbsp;
             公司网站:&nbsp;&nbsp;<a href="http://www.618shoe.com//" target="_blank">http://www.618shoe.com/</a>&nbsp;&nbsp;
             <a href="http://www.618shoe.com/">高仿鞋批发市场</a>
             微信 <img src="/pics/qrcode.jpg" style="width:100px;height:100px;">
      </div>
    </footer>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2013/03/02/object-initialization-in-java/" data-id="cja9pxgf8001mkk5ih3qex0s2" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2013/03/05/hashmap-in-java/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Newer</strong>
      <div class="article-nav-title">
        
          Java基础：HashMap
        
      </div>
    </a>
  
  
    <a href="/2012/12/24/eclipse-install-guide/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">eclipse install guide</div>
    </a>
  
</nav>

  
</article>

</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Categories</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Algorithm/">Algorithm</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Architecture/">Architecture</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/DevTools/">DevTools</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/DevTools-Eclipse/">DevTools Eclipse</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Java/">Java</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Java-Btrace/">Java Btrace</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Java-JVM/">Java JVM</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Java-MultiThreading/">Java MultiThreading</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Java-NIO/">Java NIO</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Java-Reflection/">Java Reflection</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Java-Unicode/">Java Unicode</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Linux-Shell/">Linux Shell</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/MongoDB/">MongoDB</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/NSQ-golang/">NSQ golang</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Python/">Python</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Solr/">Solr</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Solr-Lucene/">Solr Lucene</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Unicode-Python/">Unicode Python</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/git-DevTools/">git DevTools</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/jafka-zookeeper/">jafka zookeeper</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/jsonp-security/">jsonp security</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/thrift/">thrift</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/zookeeper/">zookeeper</a></li></ul>
    </div>
  </div>


  
    

  
    
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/11/">November 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/01/">January 2015</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/02/">February 2014</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/08/">August 2013</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/07/">July 2013</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/03/">March 2013</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2012/12/">December 2012</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2017/11/21/hello-world/">Hello World</a>
          </li>
        
          <li>
            <a href="/2015/01/16/process-task-by-queue/">process task by queue</a>
          </li>
        
          <li>
            <a href="/2015/01/15/threadpoolexecutor/">ThreadPoolExecutor 学习笔记</a>
          </li>
        
          <li>
            <a href="/2014/02/19/nsq-internals/">nsq internals</a>
          </li>
        
          <li>
            <a href="/2014/02/18/nsq-design/">nsq design</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
 	<div id="footer-info" class="inner">
     咨询QQ：<a title="点击这里给我发消息" href="http://wpa.qq.com/msgrd?v=3&amp;uin=2727291807&amp;site=www.cactussoft.cn&amp;menu=yes" target="_blank"><img src="http://wpa.qq.com/pa?p=2:2727291807:41"></a>
 	</div>
   	<div id="footer-info" class="inner">
     	<a href="http://www.618shoe.com/">莆田高仿鞋批发</a>&nbsp;&nbsp;
     	<a href="http://www.618shoe.com/">1：1高仿鞋批发</a>&nbsp;&nbsp;
     	<a href="http://www.618shoe.com/">高仿鞋批发市场</a>&nbsp;&nbsp;
     	<a href="http://www.618shoe.com/">高仿鞋网</a>&nbsp;&nbsp;
     	<a href="http://www.618shoe.com/">广州高仿鞋批发</a>&nbsp;&nbsp;
    	<a href="http://www.618shoe.com/">外贸尾单鞋批发</a>&nbsp;&nbsp;
    	<a href="http://www.618shoe.com/">精仿鞋专线</a>&nbsp;&nbsp;
	</div>
 	<div id="footer-info" class="inner">
         <a href="http://www.618shoe.com/">莆田高仿鞋批发微信号</a>&nbsp;&nbsp;
         公司网站:&nbsp;&nbsp;<a href="http://www.618shoe.com//" target="_blank">http://www.618shoe.com/</a>&nbsp;&nbsp;
         <a href="http://www.618shoe.com/">高仿鞋批发市场</a>
         微信 <img src="/pics/qrcode.jpg" style="width:100px;height:100px;">
 	</div>
    <div id="footer-info" class="inner">
      &copy; 2017 Sharewind<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>

  </div>
</body>
</html>